"use strict";async function checkSumSubConnection(){const e=process.env.SUMSUB_API_KEY,t=process.env.SUMSUB_API_SECRET;if(!e||!t)return{connected:!1,message:"Missing API credentials. Please configure SUMSUB_API_KEY and SUMSUB_API_SECRET."};try{const n=Math.floor(Date.now()/1e3).toString(),i=crypto_1.default.createHmac("sha256",t).update(n+"GET/resources/checks").digest("hex"),c=await fetch("https://api.sumsub.com/resources/checks",{method:"GET",headers:{"X-App-Token":e,"X-App-Access-Sig":i,"X-App-Access-Ts":n,Accept:"application/json"}});if(c.ok)return{connected:!0,message:"Successfully connected to SumSub API"};return{connected:!1,message:`SumSub connection failed: ${(await c.json()).description||c.statusText}`}}catch(e){return{connected:!1,message:`SumSub connection error: ${e.message}`}}}async function checkGeminiConnection(e){const t=process.env.GEMINI_API_KEY;if(!t)return{connected:!1,message:"Missing API key. Please configure GEMINI_API_KEY."};try{const{GoogleGenerativeAI:n}=await Promise.resolve().then(()=>__importStar(require("@google/generative-ai"))),i=new n(t).getGenerativeModel({model:e}),c=await i.generateContent(["Test connection"]);return c.response&&c.response.text()?{connected:!0,message:"Successfully connected to Gemini API"}:{connected:!1,message:"Gemini connection failed: No response received"}}catch(e){let t="Gemini connection error";t=401===e.status?"Authentication failed - invalid API key":429===e.status?"Rate limit exceeded":503===e.status?"Gemini service unavailable":`Gemini connection error: ${e.message}`;return{connected:!1,message:t}}}async function checkDeepSeekConnection(){const e=process.env.DEEPSEEK_API_KEY;if(!e)return{connected:!1,message:"Missing API key. Please configure DEEPSEEK_API_KEY."};try{const t=await fetch("https://api.deepseek.com/v1/models",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(t.ok)return{connected:!0,message:"Successfully connected to DeepSeek API"};{await t.text();let e="DeepSeek connection failed";if(401===t.status)e="Authentication failed - invalid API key";else{if(429===t.status)return{connected:!0,message:"API key is valid (rate limit reached, but connection successful)"};e=503===t.status?"DeepSeek service unavailable":`DeepSeek connection failed: ${t.statusText}`}return{connected:!1,message:e}}}catch(e){return{connected:!1,message:`DeepSeek connection error: ${e.message}`}}}var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var c=Object.getOwnPropertyDescriptor(t,n);c&&!("get"in c?!t.__esModule:c.writable||c.configurable)||(c={enumerable:!0,get:function(){return t[n]}});Object.defineProperty(e,i,c)}:function(e,t,n,i){void 0===i&&(i=n);e[i]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(){var e=function(t){e=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t};return e(t)};return function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var i=e(t),c=0;c<i.length;c++)"default"!==i[c]&&__createBinding(n,t,i[c]);__setModuleDefault(n,t);return n}}(),__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const error_1=require("@b/utils/error"),crypto_1=__importDefault(require("crypto")),console_1=require("@b/utils/console");exports.metadata={summary:"Check Verification Service Connection",description:"Checks the connection status with a specific verification service.",operationId:"checkVerificationServiceConnection",tags:["KYC","Verification Services"],logModule:"ADMIN_CRM",logTitle:"Check verification service connection",parameters:[{index:0,name:"id",in:"path",description:"Verification service ID",required:!0,schema:{type:"string"}}],responses:{200:{description:"Connection check completed.",content:{"application/json":{schema:{type:"object",properties:{connected:{type:"boolean",description:"Whether the connection is successful"},message:{type:"string",description:"Additional information about the connection status"}}}}}},404:{description:"Verification service not found."},500:{description:"Internal Server Error."}}};exports.default=async e=>{const{params:t,ctx:n}=e;try{const{id:e}=t;null==n||n.step(`Checking connection to ${e}`);let i;if(e.startsWith("sumsub"))i=await checkSumSubConnection();else if(e.startsWith("gemini"))i=await checkGeminiConnection(e);else{if(!e.startsWith("deepseek"))throw(0,error_1.createError)({statusCode:404,message:"Verification service not found"});i=await checkDeepSeekConnection()}i.connected?null==n||n.success("Connection successful"):null==n||n.warn(`Connection failed: ${i.message}`);return i}catch(e){null==n||n.fail("Failed to check connection");console_1.logger.error("KYC","Error in checkVerificationServiceConnection",e);throw(0,error_1.createError)({statusCode:e.statusCode||500,message:e.message||"Failed to check connection with verification service"})}};