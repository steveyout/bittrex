"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),query_1=require("@b/utils/query"),utils_1=require("../../utils");exports.metadata={summary:"Retrieve specific Forex Investment Plan",description:"Fetches details of a specific Forex investment plan for the logged-in user along with available durations, plus the total number of distinct investors and the total invested amount.",operationId:"getForexPlanById",tags:["Forex","Plan"],parameters:[{index:0,name:"id",in:"path",required:!0,schema:{type:"string",description:"Forex investment plan ID"}}],responses:{200:{description:"Forex plan retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{...utils_1.baseForexPlanSchema,durations:{type:"array",items:{type:"object",properties:{id:{type:"string"},duration:{type:"number"},timeframe:{type:"string"}}}},totalInvestors:{type:"number",description:"Total distinct users who invested in this plan"},invested:{type:"number",description:"Total invested amount in this plan"}}}}}},401:query_1.unauthorizedResponse,404:(0,query_1.notFoundMetadataResponse)("Forex Plan"),500:query_1.serverErrorResponse},requiresAuth:!0,logModule:"FOREX",logTitle:"Get Forex Plan"};exports.default=async e=>{const{user:t,params:r,ctx:s}=e;if(!(null==t?void 0:t.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});const{id:o}=r;try{const e=await db_1.models.forexPlan.findOne({where:{id:o,status:!0},include:[{model:db_1.models.forexDuration,as:"durations",attributes:["id","duration","timeframe"],through:{attributes:[]}}],attributes:["id","title","description","image","minAmount","maxAmount","profitPercentage","currency","walletType","trending"]});if(!e)throw(0,error_1.createError)({statusCode:404,message:"Forex Plan not found"});const t=await db_1.models.forexInvestment.count({where:{planId:o},distinct:!0,col:"userId"}),r=await db_1.models.forexInvestment.sum("amount",{where:{planId:o}}),n=e.toJSON();n.totalInvestors=t||0;n.invested=r||0;null==s||s.success("Request completed successfully");return n}catch(e){console.error("Error fetching forex plan:",e);throw(0,error_1.createError)({statusCode:500,message:"Internal Server Error"})}};