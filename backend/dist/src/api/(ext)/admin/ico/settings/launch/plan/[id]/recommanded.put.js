"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const query_1=require("@b/utils/query"),error_1=require("@b/utils/error"),db_1=require("@b/db"),errors_1=require("@b/utils/schema/errors");exports.metadata={summary:"Set Recommended ICO Launch Plan",description:"Updates the recommended flag for a launch plan. When setting recommended to true, automatically clears the flag from all other plans to ensure only one plan is recommended at a time.",operationId:"setRecommendedIcoLaunchPlan",tags:["Admin","ICO","Settings"],parameters:[{index:0,name:"id",in:"path",description:"ID of the launch plan to update recommended flag",required:!0,schema:{type:"string"}}],requestBody:{description:"Request body must contain the recommended flag",content:{"application/json":{schema:{type:"object",properties:{recommended:{type:"boolean",description:"Recommended flag. When true, this plan will be the only recommended plan; when false, this plan will be marked as not recommended"}},required:["recommended"]}}}},responses:{200:{description:"Launch plan recommended status updated successfully",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}},400:errors_1.badRequestResponse,401:errors_1.unauthorizedResponse,404:(0,errors_1.notFoundResponse)("Launch Plan"),500:errors_1.serverErrorResponse},requiresAuth:!0,permission:"edit.ico.settings",logModule:"ADMIN_ICO",logTitle:"Set recommended launch plan"};exports.default=async e=>{const{body:r,params:n,ctx:t}=e,{id:o}=n,{recommended:a}=r;null==t||t.step("Validating recommended flag");if("boolean"!=typeof a){null==t||t.fail("Invalid recommended flag type");throw(0,error_1.createError)({statusCode:400,message:"The recommended flag must be a boolean"})}if(a){null==t||t.step("Clearing existing recommended plans");const e=await db_1.models.icoLaunchPlan.findAll({where:{recommended:!0}});await Promise.all(e.map(e=>(0,query_1.updateRecord)("icoLaunchPlan",e.id,{recommended:!1})))}null==t||t.step("Setting recommended flag");const s=await(0,query_1.updateRecord)("icoLaunchPlan",o,{recommended:a});null==t||t.success("Launch plan recommended flag updated successfully");return s};