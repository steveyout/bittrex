"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),sequelize_1=require("sequelize");exports.metadata={summary:"Get Staking Pool by ID",description:"Retrieves a specific staking pool by its ID with related data.",operationId:"getStakingPoolById",tags:["Staking","Admin","Pools"],requiresAuth:!0,logModule:"ADMIN_STAKE",logTitle:"Get Staking Pool",parameters:[{index:0,name:"id",in:"path",required:!0,schema:{type:"string"},description:"Pool ID"}],responses:{200:{description:"Pool retrieved successfully",content:{"application/json":{schema:{type:"object"}}}},401:{description:"Unauthorized"},404:{description:"Pool not found"},500:{description:"Internal Server Error"}},permission:"view.staking.pool"};exports.default=async e=>{const{user:o,params:r,ctx:t}=e;if(!(null==o?void 0:o.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});const s=r.id;if(!s)throw(0,error_1.createError)({statusCode:400,message:"Pool ID is required"});try{null==t||t.step("Fetching data");const e=await db_1.models.stakingPool.findOne({where:{id:s},attributes:{include:[[(0,sequelize_1.literal)("(\n              SELECT COALESCE(SUM(sp.amount), 0)\n              FROM staking_positions AS sp\n              WHERE sp.poolId = stakingPool.id\n            )"),"totalStaked"]]},include:[{model:db_1.models.stakingPosition,as:"positions",required:!1},{model:db_1.models.stakingAdminEarning,as:"adminEarnings",required:!1},{model:db_1.models.stakingExternalPoolPerformance,as:"performances",required:!1}]});if(!e)throw(0,error_1.createError)({statusCode:404,message:"Pool not found"});null==t||t.success("Operation completed successfully");return e}catch(e){if(404===e.statusCode)throw e;console.error(`Error fetching staking pool ${s}:`,e);throw(0,error_1.createError)({statusCode:500,message:`Failed to fetch staking pool ${s}`})}};