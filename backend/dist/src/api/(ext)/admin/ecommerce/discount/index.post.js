"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const query_1=require("@b/utils/query"),utils_1=require("./utils");exports.metadata={summary:"Creates a new ecommerce discount",operationId:"createEcommerceDiscount",description:"Creates a new ecommerce discount code with specified percentage, validity period, and product association. The discount code must be unique and the percentage must be between 0 and 100. The validity date must be in the future.",tags:["Admin","Ecommerce","Discount"],requestBody:{required:!0,content:{"application/json":{schema:utils_1.discountUpdateSchema}}},responses:(0,query_1.storeRecordResponses)(utils_1.discountStoreSchema,"E-commerce Discount"),requiresAuth:!0,permission:"create.ecommerce.discount",logModule:"ADMIN_ECOM",logTitle:"Create discount"};exports.default=async e=>{const{body:t,ctx:s}=e,{code:c,percentage:o,validUntil:r,productId:i,status:u}=t;null==s||s.step("Validating discount data");null==s||s.step("Creating discount record");const a=await(0,query_1.storeRecord)({model:"ecommerceDiscount",data:{code:c,percentage:o,validUntil:r,productId:i,status:u}});null==s||s.success(`Discount created: ${c}`);return a};