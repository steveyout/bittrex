"use strict";async function sendOrderStatusUpdateEmail(e,t,a,d){var r,s,c,i,l;try{null===(r=null==d?void 0:d.step)||void 0===r||r.call(d,"Retrieving order items from database");const l=await db_1.models.ecommerceOrderItem.findAll({where:{orderId:t.id},include:[{model:db_1.models.ecommerceProduct,as:"product",attributes:["name","price","currency"]}]});null===(s=null==d?void 0:d.step)||void 0===s||s.call(d,"Constructing email data");const m=l.map(e=>`\n    <li>Product Name: ${e.product.name}</li>\n    <li>Quantity: ${e.quantity}</li>\n    <li>Price: ${e.product.price} ${e.product.currency}</li>\n  `).join(""),u={TO:e.email,CUSTOMER_NAME:e.firstName,ORDER_NUMBER:t.id,ORDER_STATUS:a,PRODUCT_DETAILS:m};null===(c=null==d?void 0:d.step)||void 0===c||c.call(d,"Adding email to queue");await emails_1.emailQueue.add({emailData:u,emailType:"OrderStatusUpdate"});null===(i=null==d?void 0:d.success)||void 0===i||i.call(d,"Order status update email sent successfully")}catch(e){null===(l=null==d?void 0:d.fail)||void 0===l||l.call(d,e.message);throw e}}Object.defineProperty(exports,"__esModule",{value:!0});exports.ecommerceOrderUpdateSchema=exports.baseEcommerceOrderSchema=exports.ecommerceOrderSchema=void 0;exports.sendOrderStatusUpdateEmail=sendOrderStatusUpdateEmail;const db_1=require("@b/db"),emails_1=require("@b/utils/emails"),schema_1=require("@b/utils/schema"),id=(0,schema_1.baseStringSchema)("ID of the e-commerce order"),userId=(0,schema_1.baseStringSchema)("User ID associated with the order"),status=(0,schema_1.baseEnumSchema)("Status of the order",["PENDING","COMPLETED","CANCELLED","REJECTED"]),createdAt=(0,schema_1.baseDateTimeSchema)("Creation date of the order",!0),updatedAt=(0,schema_1.baseDateTimeSchema)("Last update date of the order",!0),deletedAt=(0,schema_1.baseDateTimeSchema)("Deletion date of the order",!0);exports.ecommerceOrderSchema={id:id,userId:userId,status:status,createdAt:createdAt,updatedAt:updatedAt,deletedAt:deletedAt};exports.baseEcommerceOrderSchema={id:id,userId:userId,status:status,createdAt:createdAt,deletedAt:deletedAt,updatedAt:updatedAt};exports.ecommerceOrderUpdateSchema={type:"object",properties:{status:status},required:["status"]};