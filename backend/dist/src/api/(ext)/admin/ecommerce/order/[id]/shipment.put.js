"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),query_1=require("@b/utils/query");exports.metadata={summary:"Assigns a shipment to an order",description:"Assigns a specific shipment to an order.",operationId:"assignShipmentToOrder",tags:["Admin","Ecommerce Orders"],requiresAuth:!0,logModule:"ADMIN_ECOM",logTitle:"Assign shipment to order",parameters:[{index:0,in:"path",name:"id",required:!0,description:"Order ID",schema:{type:"string"}}],requestBody:{required:!0,content:{"application/json":{schema:{type:"object",properties:{shipmentId:{type:"string",description:"Shipment ID"}},required:["shipmentId"]}}}},responses:(0,query_1.createRecordResponses)("Shipment Assignment"),permission:"edit.ecommerce.order"};exports.default=async e=>{const{body:r,params:s,ctx:t}=e,{id:i}=s,{shipmentId:n}=r;null==t||t.step("Validating order and shipment IDs");const o=await db_1.sequelize.transaction();try{null==t||t.step(`Finding order: ${i}`);const e=await db_1.models.ecommerceOrder.findByPk(i);if(!e)throw(0,error_1.createError)({statusCode:404,message:"Order not found"});null==t||t.step(`Finding shipment: ${n}`);if(!await db_1.models.ecommerceShipping.findByPk(n))throw(0,error_1.createError)({statusCode:404,message:"Shipment not found"});null==t||t.step("Assigning shipment to order");await e.update({shippingId:n},{transaction:o});await o.commit();null==t||t.success("Shipment assigned to order successfully");return{message:"Shipment assigned to order successfully"}}catch(e){null==t||t.fail("Failed to assign shipment");await o.rollback();throw(0,error_1.createError)({statusCode:500,message:e.message})}};