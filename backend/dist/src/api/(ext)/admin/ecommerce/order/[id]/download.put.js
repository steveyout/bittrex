"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),query_1=require("@b/utils/query");exports.metadata={summary:"Adds download details to an order item",description:"Adds or updates the download details for a specific order item.",operationId:"addDownloadDetails",tags:["Admin","Ecommerce Orders"],requiresAuth:!0,logModule:"ADMIN_ECOM",logTitle:"Add order download details",requestBody:{required:!0,content:{"application/json":{schema:{type:"object",properties:{orderItemId:{type:"string",description:"Order Item ID"},key:{type:"string",description:"License Key",nullable:!0},filePath:{type:"string",description:"Download File Path",nullable:!0},instructions:{type:"string",description:"Instructions for the download",nullable:!0}},required:["orderItemId"]}}}},responses:(0,query_1.createRecordResponses)("Order Item"),permission:"view.ecommerce.order"};exports.default=async e=>{const{body:t,ctx:r}=e,{orderItemId:d,key:o,filePath:s,instructions:a}=t;null==r||r.step("Validating order item ID");const i=await db_1.sequelize.transaction();try{null==r||r.step(`Finding order item: ${d}`);const e=await db_1.models.ecommerceOrderItem.findByPk(d);if(!e)throw(0,error_1.createError)({statusCode:404,message:"Order item not found"});null==r||r.step("Updating download details");await e.update({key:o,filePath:s,instructions:a},{transaction:i});await i.commit();null==r||r.success("Download details added/updated successfully");return{message:"Download details added/updated successfully"}}catch(e){null==r||r.fail("Failed to update download details");await i.rollback();throw(0,error_1.createError)({statusCode:500,message:e.message})}};