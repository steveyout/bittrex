"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),query_1=require("@b/utils/query");exports.metadata={summary:"Adds a shipping address to an order",description:"Adds or updates the shipping address for a specific order.",operationId:"addShippingAddress",tags:["Admin","Ecommerce Orders"],requiresAuth:!0,logModule:"ADMIN_ECOM",logTitle:"Add shipping address",parameters:[{index:0,in:"path",name:"id",required:!0,description:"Order ID",schema:{type:"string"}}],requestBody:{required:!0,content:{"application/json":{schema:{type:"object",properties:{shippingAddress:{type:"object",properties:{name:{type:"string"},email:{type:"string"},phone:{type:"string"},street:{type:"string"},city:{type:"string"},state:{type:"string"},postalCode:{type:"string"},country:{type:"string"}},required:["name","email","phone","street","city","state","postalCode","country"]}},required:["shippingAddress"]}}}},responses:(0,query_1.createRecordResponses)("Shipping Address"),permission:"edit.ecommerce.order"};exports.default=async e=>{const{body:r,params:s,ctx:t}=e,{id:d}=s,{shippingAddress:i}=r;null==t||t.step("Validating order ID");const a=await db_1.sequelize.transaction();try{null==t||t.step(`Finding order: ${d}`);if(!await db_1.models.ecommerceOrder.findByPk(d))throw(0,error_1.createError)({statusCode:404,message:"Order not found"});null==t||t.step("Checking for existing shipping address");const e=await db_1.models.ecommerceShippingAddress.findOne({where:{orderId:d}});if(e){null==t||t.step("Updating existing shipping address");await e.update(i,{transaction:a})}else{null==t||t.step("Creating new shipping address");await db_1.models.ecommerceShippingAddress.create({orderId:d,...i},{transaction:a})}await a.commit();null==t||t.success("Shipping address added/updated successfully");return{message:"Shipping address added/updated successfully"}}catch(e){null==t||t.fail("Failed to add/update shipping address");await a.rollback();throw(0,error_1.createError)({statusCode:500,message:e.message})}};