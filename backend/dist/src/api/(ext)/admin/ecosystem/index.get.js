"use strict";async function checkChainEnvVariables(){return{utxoChains:["BTC","LTC","DOGE","DASH"].map(e=>({chain:e,info:{network:process.env[`${e}_NETWORK`]||"mainnet",nodeProvider:process.env[`${e}_NODE`]||"blockcypher"}})),evmChains:["ETH","BSC","POLYGON","FTM","OPTIMISM","ARBITRUM","BASE","CELO"].map(e=>{const s=process.env[`${e}_NETWORK`]||"",n=process.env[`${e}_${s.toUpperCase()}_RPC`],t=process.env[`${e}_${s.toUpperCase()}_RPC_WSS`];return{chain:e,info:{network:s,rpc:!!n,rpcWss:!!t,explorerApi:!!process.env[`${e}_EXPLORER_API_KEY`]}}})}}async function fetchExtendedChainsStatus(){const e=["SOL","TRON","XMR","TON","MO"],s={SOL:process.env.SOL_NETWORK||"mainnet",TRON:process.env.TRON_NETWORK||"mainnet",XMR:process.env.XMR_NETWORK||"mainnet",TON:process.env.TON_NETWORK||"mainnet",MO:process.env.MO_NETWORK||"mainnet"},n=await db_1.models.ecosystemBlockchain.findAll({where:{chain:{[sequelize_1.Op.in]:e}}});return e.map(e=>{const t=n.find(s=>s.chain===e),o=s[e],r=process.env[`${e}_${o.toUpperCase()}_RPC`],i=process.env[`${e}_${o.toUpperCase()}_RPC_WSS`];return{chain:e,info:{network:o,rpc:!!r,rpcWss:!!i,explorerApi:!["MO","TON"].includes(e),status:(null==t?void 0:t.status)||!1,version:null==t?void 0:t.version,productId:null==t?void 0:t.productId}}})}Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;exports.checkChainEnvVariables=checkChainEnvVariables;const encrypt_1=require("@b/utils/encrypt"),query_1=require("@b/utils/query"),db_1=require("@b/db"),sequelize_1=require("sequelize"),error_1=require("@b/utils/error");exports.metadata={summary:"Get ecosystem blockchains information",operationId:"getEcosystemBlockchains",tags:["Admin","Ecosystem","Blockchains"],logModule:"ADMIN_ECO",logTitle:"Get ecosystem blockchains",responses:{200:{description:"Ecosystem blockchains information",content:{"application/json":{schema:{type:"object",properties:{baseChains:{type:"array",items:{type:"object",properties:{chain:{type:"string"},info:{type:"object",properties:{network:{type:"string"},nodeProvider:{type:"string"},rpc:{type:"boolean"},rpcWss:{type:"boolean"},explorerApi:{type:"boolean"}}}}}},extendedChains:{type:"array",items:{type:"object",properties:{chain:{type:"string"},info:{type:"object",properties:{network:{type:"string"},license:{type:"string"},status:{type:"boolean"}}}}}},isUnlockedVault:{type:"boolean"}}}}}},401:query_1.unauthorizedResponse,404:(0,query_1.notFoundMetadataResponse)("Ecosystem Blockchains"),500:query_1.serverErrorResponse},requiresAuth:!0,permission:"access.ecosystem"};exports.default=async e=>{const{ctx:s}=e;try{null==s||s.step("Checking chain environment variables");const{utxoChains:e,evmChains:n}=await checkChainEnvVariables();null==s||s.step("Fetching extended chains status");const t=await fetchExtendedChainsStatus();null==s||s.step("Checking vault unlock status");const o=(0,encrypt_1.isUnlockedEcosystemVault)();null==s||s.success("Ecosystem blockchains retrieved successfully");return{baseChains:e.map(e=>({chain:e.chain,info:e.info})).concat(n.map(e=>({chain:e.chain,info:e.info}))),extendedChains:t.map(e=>({chain:e.chain,info:e.info})),isUnlockedVault:o}}catch(e){null==s||s.fail(e.message);throw(0,error_1.createError)({statusCode:500,message:`Failed to fetch ecosystem blockchains: ${e.message}`})}};