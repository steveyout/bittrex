"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.holdersController=exports.metadata=void 0;const error_1=require("@b/utils/error"),utils_1=require("../utils"),tokens_1=require("@b/api/(ext)/ecosystem/utils/tokens"),query_1=require("@b/utils/query"),errors_1=require("@b/utils/schema/errors");exports.metadata={summary:"Fetches token holders for an ecosystem token",description:"Retrieves a list of all holders and their balances for a specific ecosystem token by querying the blockchain. Returns both the token details and the list of holder addresses with their respective balances.",operationId:"getEcosystemTokenHolders",tags:["Admin","Ecosystem","Token"],logModule:"ADMIN_ECO",logTitle:"Get token holders",parameters:[{name:"id",in:"path",required:!0,description:"ID of the ecosystem token",schema:{type:"string"}}],responses:{200:{description:"Token holders retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{token:{type:"object",properties:{id:{type:"string",description:"Token ID"},name:{type:"string",description:"Token name"},contract:{type:"string",description:"Token contract address"},currency:{type:"string",description:"Token currency symbol"},chain:{type:"string",description:"Blockchain chain"}}},holders:{type:"array",items:{type:"object",properties:{address:{type:"string",description:"Holder's wallet address"},balance:{type:"string",description:"Amount of tokens held"}}}}}}}}},401:query_1.unauthorizedResponse,404:(0,errors_1.notFoundResponse)("Ecosystem Token"),500:query_1.serverErrorResponse},requiresAuth:!0,permission:"view.ecosystem.token"};const holdersController=async e=>{const{user:t,params:r,ctx:s}=e;if(!(null==t?void 0:t.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});try{const{id:e}=r;null==s||s.step("Fetching token details");const t=await(0,utils_1.getEcosystemTokenById)(e);if(!t)throw(0,error_1.createError)({statusCode:404,message:`Token not found for id: ${e}`});null==s||s.step("Fetching token holders");const o=await(0,tokens_1.fetchTokenHolders)(t.chain,t.network,t.contract);null==s||s.success(`Retrieved ${o.length} token holders`);return{token:t,holders:o}}catch(e){null==s||s.fail(e.message);throw(0,error_1.createError)({statusCode:500,message:`Failed to fetch token holders: ${e.message}`})}};exports.holdersController=holdersController;