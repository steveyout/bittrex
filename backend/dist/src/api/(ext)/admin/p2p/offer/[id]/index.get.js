"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),errors_1=require("@b/utils/schema/errors");exports.metadata={summary:"Get P2P offer by ID",description:"Retrieves detailed information about a specific P2P offer including user details, payment methods, statistics, and pricing configuration.",operationId:"getAdminP2POfferById",tags:["Admin","P2P","Offer"],requiresAuth:!0,logModule:"ADMIN_P2P",logTitle:"Get P2P Offer",parameters:[{index:0,name:"id",in:"path",description:"Offer ID",required:!0,schema:{type:"string"}}],responses:{200:{description:"Offer retrieved successfully."},401:errors_1.unauthorizedResponse,404:(0,errors_1.notFoundResponse)("Resource"),500:errors_1.serverErrorResponse},permission:"view.p2p.offer",demoMask:["user.email"]};exports.default=async e=>{const{params:r,ctx:s}=e,{id:t}=r;try{null==s||s.step("Fetching data");const e=await db_1.models.p2pOffer.findByPk(t,{include:[{model:db_1.models.user,as:"user",attributes:["id","firstName","lastName","email","avatar","createdAt"]},{model:db_1.models.p2pPaymentMethod,as:"paymentMethods",attributes:["id","name","icon"],through:{attributes:[]}}]});if(!e)throw(0,error_1.createError)({statusCode:404,message:"Offer not found"});const r={totalTrades:0,completedTrades:0,avgCompletionTime:0,successRate:0},o={totalOffers:await db_1.models.p2pOffer.count({where:{userId:e.userId}}),completedTrades:0,rating:0,disputes:0},a=e.toJSON();a.stats=r;a.user={...a.user,stats:o};!a.priceCurrency&&a.priceConfig&&(a.priceCurrency=a.priceConfig.currency||"USD");null==s||s.success("Operation completed successfully");return a}catch(e){if(e.statusCode)throw e;throw(0,error_1.createError)({statusCode:500,message:"Internal Server Error: "+e.message})}};