"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),utils_1=require("@b/api/(ext)/copy-trading/utils");exports.metadata={summary:"Activate Leader (Admin)",description:"Reactivates a suspended leader.",operationId:"adminActivateCopyTradingLeader",tags:["Admin","Copy Trading"],requiresAuth:!0,permission:"access.copy_trading",middleware:["copyTradingAdmin"],logModule:"ADMIN_COPY",logTitle:"Activate copy trading leader",parameters:[{name:"id",in:"path",required:!0,schema:{type:"string"}}],responses:{200:{description:"Leader activated successfully"},400:{description:"Bad Request"},401:{description:"Unauthorized"},403:{description:"Forbidden"},404:{description:"Leader not found"},500:{description:"Internal Server Error"}}};exports.default=async e=>{const{params:t,user:a,ctx:r}=e,{id:s}=t;null==r||r.step("Fetching leader");const d=await db_1.models.copyTradingLeader.findByPk(s);if(!d){null==r||r.fail("Leader not found");throw(0,error_1.createError)({statusCode:404,message:"Leader not found"})}null==r||r.step("Validating leader status");if("SUSPENDED"!==d.status){null==r||r.fail(`Can only activate suspended leaders. Current status: ${d.status}`);throw(0,error_1.createError)({statusCode:400,message:`Can only activate suspended leaders. Current status: ${d.status}`})}null==r||r.step("Activating leader");const i=d.status;await d.update({status:"ACTIVE"});null==r||r.step("Creating audit log");await(0,utils_1.createAuditLog)({entityType:"LEADER",entityId:s,action:"ACTIVATE",oldValue:{status:i},newValue:{status:"ACTIVE"},adminId:null==a?void 0:a.id});null==r||r.success("Leader activated successfully");return{message:"Leader activated successfully",leader:d.toJSON()}};