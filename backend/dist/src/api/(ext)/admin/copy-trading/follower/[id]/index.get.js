"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),errors_1=require("@b/utils/schema/errors");exports.metadata={summary:"Get copy trading follower details",description:"Retrieves detailed information about a specific copy trading follower subscription, including user and leader details, recent trades (up to 50), and recent transactions (up to 50). This provides a comprehensive view of the follower's copy trading activity.",operationId:"getCopyTradingFollowerById",tags:["Admin","Copy Trading","Follower"],requiresAuth:!0,logModule:"ADMIN_COPY",logTitle:"Get Copy Trading Follower Details",permission:"access.copy_trading",demoMask:["user.email"],parameters:[{name:"id",in:"path",required:!0,description:"Unique identifier of the follower subscription",schema:{type:"string",format:"uuid"}}],responses:{200:{description:"Follower details retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{...errors_1.commonFields,userId:{type:"string",format:"uuid",description:"ID of the user following the leader"},leaderId:{type:"string",format:"uuid",description:"ID of the leader being followed"},copyMode:{type:"string",enum:["PROPORTIONAL","FIXED_AMOUNT","FIXED_RATIO"],description:"Copy trading mode"},fixedAmount:{type:"number",nullable:!0,description:"Fixed amount per trade (if using FIXED_AMOUNT mode)"},fixedRatio:{type:"number",nullable:!0,description:"Fixed ratio multiplier (if using FIXED_RATIO mode)"},maxDailyLoss:{type:"number",nullable:!0,description:"Maximum daily loss limit"},maxPositionSize:{type:"number",nullable:!0,description:"Maximum position size limit"},stopLossPercent:{type:"number",nullable:!0,description:"Stop loss percentage"},takeProfitPercent:{type:"number",nullable:!0,description:"Take profit percentage"},totalProfit:{type:"number",description:"Total profit/loss from all trades"},totalTrades:{type:"integer",description:"Total number of trades executed"},winRate:{type:"number",description:"Win rate percentage"},roi:{type:"number",description:"Return on investment percentage"},status:{type:"string",enum:["ACTIVE","PAUSED","STOPPED"],description:"Current subscription status"},user:{type:"object",description:"User details",properties:{id:{type:"string",format:"uuid"},firstName:{type:"string"},lastName:{type:"string"},email:{type:"string",format:"email"},avatar:{type:"string",nullable:!0}}},leader:{type:"object",description:"Leader details",properties:{id:{type:"string",format:"uuid"},displayName:{type:"string"},avatar:{type:"string",nullable:!0},tradingStyle:{type:"string",nullable:!0},riskLevel:{type:"string",nullable:!0},profitSharePercent:{type:"number",nullable:!0}}},trades:{type:"array",description:"Recent trades (up to 50)",items:{type:"object",properties:{...errors_1.commonFields,leaderId:{type:"string",format:"uuid"},followerId:{type:"string",format:"uuid",nullable:!0},leaderOrderId:{type:"string",nullable:!0},symbol:{type:"string",description:"Trading pair symbol"},side:{type:"string",enum:["BUY","SELL"],description:"Trade side"},type:{type:"string",enum:["MARKET","LIMIT"],description:"Order type"},amount:{type:"number",description:"Trade amount"},price:{type:"number",description:"Trade price"},cost:{type:"number",description:"Total cost"},fee:{type:"number",description:"Trading fee"},feeCurrency:{type:"string",description:"Fee currency"},executedAmount:{type:"number",description:"Executed amount"},executedPrice:{type:"number",description:"Executed price"},slippage:{type:"number",nullable:!0,description:"Slippage"},latencyMs:{type:"integer",nullable:!0,description:"Execution latency in milliseconds"},profit:{type:"number",nullable:!0,description:"Trade profit/loss"},profitPercent:{type:"number",nullable:!0,description:"Profit percentage"},profitCurrency:{type:"string",nullable:!0},status:{type:"string",enum:["PENDING","PENDING_REPLICATION","REPLICATED","REPLICATION_FAILED","OPEN","CLOSED","PARTIALLY_FILLED","FAILED","CANCELLED"]},errorMessage:{type:"string",nullable:!0},isLeaderTrade:{type:"boolean"},closedAt:{type:"string",format:"date-time",nullable:!0}}}},transactions:{type:"array",description:"Recent transactions (up to 50)",items:{type:"object",properties:{...errors_1.commonFields,userId:{type:"string",format:"uuid"},leaderId:{type:"string",format:"uuid",nullable:!0},followerId:{type:"string",format:"uuid",nullable:!0},tradeId:{type:"string",format:"uuid",nullable:!0},type:{type:"string",enum:["ALLOCATION","DEALLOCATION","PROFIT_SHARE","TRADE_PROFIT","TRADE_LOSS","FEE","REFUND"]},amount:{type:"number"},currency:{type:"string"},fee:{type:"number"},balanceBefore:{type:"number"},balanceAfter:{type:"number"},status:{type:"string",enum:["PENDING","COMPLETED","FAILED"]},description:{type:"string",nullable:!0},metadata:{type:"string",nullable:!0}}}}}}}}},401:errors_1.unauthorizedResponse,404:(0,errors_1.notFoundResponse)("Follower"),500:errors_1.serverErrorResponse}};exports.default=async e=>{const{user:t,params:r,ctx:i}=e;if(!(null==t?void 0:t.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});const{id:o}=r;null==i||i.step("Get Copy Trading Follower");const n=await db_1.models.copyTradingFollower.findByPk(o,{include:[{model:db_1.models.user,as:"user",attributes:["id","firstName","lastName","email","avatar"]},{model:db_1.models.copyTradingLeader,as:"leader",attributes:["id","displayName","avatar","tradingStyle","riskLevel","profitSharePercent"]}]});if(!n)throw(0,error_1.createError)({statusCode:404,message:"Follower not found"});const s=await db_1.models.copyTradingTrade.findAll({where:{followerId:o},order:[["createdAt","DESC"]],limit:50}),a=await db_1.models.copyTradingTransaction.findAll({where:{followerId:o},order:[["createdAt","DESC"]],limit:50});null==i||i.success("Get Copy Trading Follower retrieved successfully");return{...n.get({plain:!0}),trades:s,transactions:a}};