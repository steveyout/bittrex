"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),query_1=require("@b/utils/query"),wallet_1=require("@b/services/wallet");exports.metadata={summary:"Deletes a specific AI Investment",operationId:"deleteAIInvestment",tags:["Admin","AI Investment"],parameters:(0,query_1.deleteRecordParams)("AI Investment"),responses:(0,query_1.deleteRecordResponses)("AI Investment"),permission:"delete.ai.investment",requiresAuth:!0,logModule:"ADMIN_AI",logTitle:"Delete AI investment"};exports.default=async e=>{const{params:t,query:n,ctx:l}=e,s={};null==l||l.step(`Deleting investment ${t.id}`);const r=await(0,query_1.handleSingleDelete)({model:"aiInvestment",id:t.id,query:{...n,force:"true",restore:void 0},preDelete:async()=>{null==l||l.step("Processing wallet refund");const e=await db_1.models.transaction.findOne({where:{referenceId:t.id},include:[{model:db_1.models.wallet,as:"wallet"}]});if(e)if(e.wallet){await wallet_1.walletService.credit({idempotencyKey:`admin_ai_investment_delete_refund_${t.id}`,userId:e.wallet.userId,walletId:e.wallet.id,walletType:e.wallet.type,currency:e.wallet.currency,amount:e.amount,operationType:"REFUND",description:`Refund for deleted AI Investment ${t.id}`});s.transactionId=e.id;null==l||l.step("Wallet refunded")}else null==l||l.warn(`Wallet not found for transaction: ${e.id}`);else null==l||l.warn(`Transaction not found for id: ${t.id}`)},postDelete:async()=>{if(s.transactionId){null==l||l.step("Cleaning up transaction record");await db_1.models.transaction.destroy({where:{id:s.transactionId}})}}});null==l||l.success("Investment deleted successfully");return r};