"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.AccumulatorBot=void 0;const BaseBot_1=require("../BaseBot");class AccumulatorBot extends BaseBot_1.BaseBot{constructor(e){super({...e,personality:"ACCUMULATOR",tradeFrequency:"LOW"});this.buyBias=.9;this.maxAccumulationPercent=2;this.supportBuildingStrength=1.5;this.totalAccumulated=BigInt(0);this.accumulationSessions=0}decideTrade(e){if(!this.canTrade())return{shouldTrade:!1,reason:"Cannot trade"};const t=Number(e.currentPrice)/1e18,r=Number(e.targetPrice)/1e18,a=(r-t)/t*100,o=t<r;if(a<-this.maxAccumulationPercent)return{shouldTrade:!1,reason:`Price too far above target (${a.toFixed(2)}%)`};if(!(Math.random()<this.buyBias))return this.totalAccumulated>BigInt(0)&&Math.random()<.1?this.createSellOrder(e,"Rebalancing small amount"):{shouldTrade:!1,reason:"Skipping - accumulator prefers buying"};const u=t<=1.05*e.priceRangeLow,c=u?this.supportBuildingStrength:1,i=this.calculatePrice(e,"BUY"),s=this.calculateOrderSize(e),n=BigInt(Math.floor(Number(s)*c));this.accumulationSessions++;return{shouldTrade:!0,side:"BUY",price:i,amount:n,purpose:o?"PRICE_PUSH":"LIQUIDITY",confidence:.7+(o?.2:0),reason:u?"Building support level":`Accumulating (session ${this.accumulationSessions})`}}createSellOrder(e,t){const r=this.calculatePrice(e,"SELL"),a=this.calculateOrderSize(e);return{shouldTrade:!0,side:"SELL",price:r,amount:BigInt(Math.floor(.3*Number(a))),purpose:"LIQUIDITY",confidence:.4,reason:t}}calculateOrderSize(e){let t=1;Number(e.currentPrice)/1e18<.98*(Number(e.targetPrice)/1e18)&&(t=1.3);const r=this.config.avgOrderSize*t,a=this.addVariance(r,.25);return BigInt(Math.floor(1e18*a))}calculatePrice(e,t){const r=Number(e.currentPrice)/1e18;if("BUY"===t){const e=r*(1-(.001+.002*Math.random()));return BigInt(Math.floor(1e18*e))}{const e=r*(1+.002*Math.random());return BigInt(Math.floor(1e18*e))}}recordTradeResult(e){super.recordTradeResult(e);e>0&&(this.totalAccumulated+=BigInt(Math.floor(1e18*e)))}getCooldownTime(){return 12e4}getAccumulationStats(){return{totalAccumulated:(Number(this.totalAccumulated)/1e18).toFixed(8),sessions:this.accumulationSessions}}}exports.AccumulatorBot=AccumulatorBot;exports.default=AccumulatorBot;