"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),utils_1=require("../../utils"),errors_1=require("@b/utils/schema/errors"),error_1=require("@b/utils/error"),queries_1=require("../../utils/scylla/queries");exports.metadata={summary:"Get AI Market Maker market by ID",operationId:"getAiMarketMakerMarketById",tags:["Admin","AI Market Maker","Market"],description:"Retrieves comprehensive details of a specific AI Market Maker market including pool balances, P&L tracking, bot configurations with performance statistics from both MySQL and ScyllaDB, ecosystem market details, and recent activity history (last 50 entries).",parameters:[{index:0,name:"id",in:"path",required:!0,description:"ID of the AI Market Maker to retrieve",schema:{type:"string"}}],responses:{200:{description:"AI Market Maker details",content:{"application/json":{schema:{type:"object",properties:{...utils_1.aiMarketMakerSchema,pool:{type:"object",description:"Pool details"},market:{type:"object",description:"Ecosystem market details"},bots:{type:"array",description:"Bot configurations"},recentActivity:{type:"array",description:"Recent activity log"}}}}}},401:errors_1.unauthorizedResponse,404:(0,errors_1.notFoundResponse)("AI Market Maker Market"),500:errors_1.serverErrorResponse},permission:"view.ai.market-maker.market",requiresAuth:!0,logModule:"ADMIN_AI",logTitle:"Get Market Maker Market"};exports.default=async e=>{const{params:t,ctx:r}=e;null==r||r.step("Get Market Maker Market");const a=await db_1.models.aiMarketMaker.findByPk(t.id,{include:[{model:db_1.models.aiMarketMakerPool,as:"pool"},{model:db_1.models.ecosystemMarket,as:"market"},{model:db_1.models.aiBot,as:"bots"}]});if(!a)throw(0,error_1.createError)(404,"AI Market Maker not found");const o=await db_1.models.aiMarketMakerHistory.findAll({where:{marketMakerId:t.id},order:[["createdAt","DESC"]],limit:50}),s=a,i=s.marketId,d=await(0,queries_1.getBotTradeStats)(i),l=(s.bots||[]).map(e=>{const t=d.get(e.id)||{tradeCount:0,totalVolume:0},r=Math.max(e.dailyTradeCount||0,t.tradeCount),a=Number(e.totalVolume||0)>0?Number(e.totalVolume):t.totalVolume;return{...e.toJSON(),botType:e.personality,dailyTradeCount:r,realTradesExecuted:e.realTradesExecuted||0,profitableTrades:e.profitableTrades||0,totalVolume:a,totalRealizedPnL:e.totalRealizedPnL||0,currentPosition:e.currentPosition||0,avgEntryPrice:e.avgEntryPrice||0,tradesExecuted:r,totalPnL:e.totalRealizedPnL||0,stats:{totalTrades:r,successRate:e.realTradesExecuted>0?(e.profitableTrades||0)/e.realTradesExecuted:0,avgProfitPerTrade:e.realTradesExecuted>0?(e.totalRealizedPnL||0)/e.realTradesExecuted:0,isActive:"ACTIVE"===e.status,timeSinceLastTrade:e.lastTradeAt?Date.now()-new Date(e.lastTradeAt).getTime():null}}});null==r||r.success("Get Market Maker Market retrieved successfully");return{...a.toJSON(),bots:l,recentActivity:o}};