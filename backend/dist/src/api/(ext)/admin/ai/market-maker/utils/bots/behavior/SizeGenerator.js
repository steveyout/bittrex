"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.SizeGenerator=void 0;class SizeGenerator{constructor(e,t=.01,i=1e3){this.roundNumberWeights={1:.15,5:.25,10:.3,25:.1,50:.1,100:.08,1e3:.02};this.positionHistory=[];this.baseSize=e;this.minSize=t;this.maxSize=i}generateSize(e={}){const{confidence:t=.5,urgency:i=.5,preferRound:s=!0}=e;let a=this.baseSize;a*=.5+t;i>.7&&(a*=1+2*(i-.7));a*=.7+.6*Math.random();s&&(a=this.roundToHumanNumber(a));a=Math.max(this.minSize,Math.min(this.maxSize,a));return a}generateScalingSize(e,t,i){const s=Math.abs(e-t);if(s<=0)return 0;let a;if("IN"===i){a=.1+.2*(t/e)+.1*Math.random()}else{a=.3-.15*(1-t/e)+.1*Math.random()}let r=s*a;r=this.roundToHumanNumber(r);return Math.max(this.minSize,r)}generateMarketAwareSize(e,t,i){let s=this.baseSize;e>.5&&(s*=1-.5*(e-.5));const a=t/(100*this.baseSize);a<1&&(s*=Math.max(.5,a));i>.001&&(s*=Math.max(.6,1-50*i));s*=.8+.4*Math.random();return this.roundToHumanNumber(Math.max(this.minSize,s))}generateIcebergSizes(e,t=.1){const i=e*t,s=e-i,a=[];let r=s;for(;r>this.minSize;){let e=r*(.1+.2*Math.random());e=this.roundToHumanNumber(e);e=Math.min(e,r);if(!(e>=this.minSize))break;a.push(e);r-=e}r>0&&a.length>0&&(a[a.length-1]+=r);return{visible:this.roundToHumanNumber(i),hidden:s,chunks:a}}getSizeForBalance(e,t=.02){let i=e*t*(.3+.4*Math.random());return this.roundToHumanNumber(Math.min(i,this.maxSize))}recordTrade(e,t){this.positionHistory.push({size:e,side:t,timestamp:Date.now()});this.positionHistory.length>100&&this.positionHistory.shift()}getAverageRecentSize(e=36e5){const t=Date.now()-e,i=this.positionHistory.filter(e=>e.timestamp>t);return 0===i.length?this.baseSize:i.reduce((e,t)=>e+t.size,0)/i.length}roundToHumanNumber(e){const t=Math.floor(Math.log10(e)),i=Math.pow(10,t),s=e/i,a=[1,1.5,2,2.5,3,4,5,6,7,7.5,8,9,10];let r=a[0],n=Math.abs(s-r);for(const e of a){const t=Math.abs(s-e);if(t<n){n=t;r=e}}return Math.random()<.2?e:r*i}generateWithDistribution(e){let t;switch(e){case"UNIFORM":t=this.minSize+Math.random()*(this.maxSize-this.minSize);break;case"NORMAL":const e=Math.random(),i=Math.random(),s=Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*i);t=this.baseSize+s*(.3*this.baseSize);break;case"SKEWED_SMALL":t=this.minSize+Math.pow(Math.random(),2)*(this.maxSize-this.minSize);break;case"SKEWED_LARGE":t=this.minSize+Math.pow(Math.random(),.5)*(this.maxSize-this.minSize);break;default:t=this.baseSize}return this.roundToHumanNumber(Math.max(this.minSize,Math.min(this.maxSize,t)))}getStats(){const e=this.positionHistory.filter(e=>"BUY"===e.side),t=this.positionHistory.filter(e=>"SELL"===e.side);return{baseSize:this.baseSize,averageRecent:this.getAverageRecentSize(),tradeCount:this.positionHistory.length,buyVolume:e.reduce((e,t)=>e+t.size,0),sellVolume:t.reduce((e,t)=>e+t.size,0)}}}exports.SizeGenerator=SizeGenerator;exports.default=SizeGenerator;