"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),utils_1=require("../../utils"),errors_1=require("@b/utils/schema/errors"),error_1=require("@b/utils/error");exports.metadata={summary:"Get AI Market Maker phase status",operationId:"getAiMarketMakerPhaseStatus",tags:["Admin","AI Market Maker","Market"],description:"Retrieves the current phase status for an AI Market Maker, including the current phase, timing information, target prices, and momentum data.",logModule:"ADMIN_MM",logTitle:"Get Market Maker Phase Status",parameters:[{index:0,name:"id",in:"path",required:!0,description:"ID of the AI Market Maker",schema:{type:"string"}}],responses:{200:{description:"Phase status retrieved successfully",content:{"application/json":{schema:utils_1.phaseStatusSchema}}},401:errors_1.unauthorizedResponse,404:(0,errors_1.notFoundResponse)("AI Market Maker Market"),500:errors_1.serverErrorResponse},requiresAuth:!0,permission:"view.ai.market-maker.market"};exports.default=async e=>{const{params:t,ctx:r}=e;null==r||r.step("Fetch market maker from database");const a=await db_1.models.aiMarketMaker.findByPk(t.id);if(!a)throw(0,error_1.createError)(404,"AI Market Maker not found");null==r||r.step("Calculate phase progress");let s=0,i=0,n=0;if(a.phaseStartedAt&&a.nextPhaseChangeAt){const e=new Date,t=new Date(a.phaseStartedAt),r=new Date(a.nextPhaseChangeAt),o=r.getTime()-t.getTime(),u=e.getTime()-t.getTime();s=Math.min(1,Math.max(0,u/o));n=Math.round(u/36e5*10)/10;i=Math.max(0,Math.round((r.getTime()-e.getTime())/36e5*10)/10)}null==r||r.success("Phase status retrieved successfully");return{currentPhase:a.currentPhase,phaseStartedAt:a.phaseStartedAt,nextPhaseChangeAt:a.nextPhaseChangeAt,phaseTargetPrice:Number(a.phaseTargetPrice),progress:s,elapsedHours:n,remainingHours:i,marketBias:a.marketBias,biasStrength:Number(a.biasStrength),trendMomentum:Number(a.trendMomentum),lastMomentumUpdate:a.lastMomentumUpdate,lastKnownPrice:Number(a.lastKnownPrice),priceMode:a.priceMode,externalSymbol:a.externalSymbol,baseVolatility:Number(a.baseVolatility),volatilityMultiplier:Number(a.volatilityMultiplier)}};