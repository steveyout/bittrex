"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.StrategyManager=void 0;const GradualDriftStrategy_1=require("./GradualDriftStrategy"),OscillationStrategy_1=require("./OscillationStrategy"),SupportResistanceStrategy_1=require("./SupportResistanceStrategy");class StrategyManager{constructor(){this.strategies=new Map;this.activeStrategies=new Map;this.registerStrategy(new GradualDriftStrategy_1.GradualDriftStrategy);this.registerStrategy(new OscillationStrategy_1.OscillationStrategy);this.registerStrategy(new SupportResistanceStrategy_1.SupportResistanceStrategy)}registerStrategy(t){this.strategies.set(t.name,t)}getStrategy(t){return this.strategies.get(t)}getAvailableStrategies(){return Array.from(this.strategies.keys())}setActiveStrategies(t,e){this.activeStrategies.set(t,e)}getActiveStrategies(t){return this.activeStrategies.get(t)||["gradual_drift"]}calculate(t,e,r,i){const s=this.getActiveStrategies(t),a=[];for(const t of s){const s=this.strategies.get(t);if(s){const t=s.calculate(e,r,i);a.push(t)}}return 0===a.length?{shouldTrade:!1,direction:"BUY",priceAdjustment:0,sizeMultiplier:1,confidence:0}:this.combineResults(a)}selectStrategy(t,e,r){return e>5?"oscillation":Math.abs(r)>5?"gradual_drift":"support_resistance"}autoSelectStrategies(t,e,r){const i=this.selectStrategy(t,e,r),s=[i];"oscillation"!==i&&e>2&&s.push("oscillation");this.setActiveStrategies(t,s)}combineResults(t){if(1===t.length)return t[0];let e=0,r=0,i=0,s=!1,a="BUY",n=0,g=0;for(const a of t){const t=a.confidence;e+=t;r+=a.priceAdjustment*t;i+=a.sizeMultiplier*t;if(a.shouldTrade){s=!0;"BUY"===a.direction?n+=t:g+=t}}if(0===e)return{shouldTrade:!1,direction:"BUY",priceAdjustment:0,sizeMultiplier:1,confidence:0};a=n>=g?"BUY":"SELL";return{shouldTrade:s,direction:a,priceAdjustment:r/e,sizeMultiplier:i/e,confidence:e/t.length}}}exports.StrategyManager=StrategyManager;exports.default=StrategyManager;