"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const utils_1=require("@b/api/(ext)/affiliate/utils"),db_1=require("@b/db"),error_1=require("@b/utils/error"),errors_1=require("@b/utils/schema/errors");exports.metadata={summary:"Fetches MLM node details by user ID",description:"Retrieves detailed information about a user MLM node including their downline structure. The structure varies based on MLM system (DIRECT/BINARY/UNILEVEL). Returns user information and their referral network.",operationId:"getAffiliateNodeById",tags:["Admin","Affiliate","Referral"],parameters:[{index:0,name:"id",in:"path",required:!0,schema:{type:"string",format:"uuid",description:"User ID"}}],responses:{200:{description:"Node details retrieved successfully",content:{"application/json":{schema:{type:"object",description:"User node with referral details"}}}},401:errors_1.unauthorizedResponse,404:(0,errors_1.notFoundResponse)("Node"),500:errors_1.serverErrorResponse},requiresAuth:!0,permission:"view.affiliate.referral",logModule:"ADMIN_AFFILIATE",logTitle:"Get MLM node details"};exports.default=async e=>{const{params:r,ctx:s}=e,{id:t}=r;null==s||s.step(`Fetching user node with ID: ${t}`);const i=await db_1.models.user.findByPk(t,{include:[{model:db_1.models.mlmReferral,as:"referrer",include:[{model:db_1.models.user,as:"referred"}]},{model:db_1.models.mlmReferral,as:"referred"}]});if(!i)throw(0,error_1.createError)({statusCode:404,message:"User not found"});null==s||s.step("Loading MLM system settings");const{mlmSystem:a,mlmSettings:o}=await(0,utils_1.getMlmSystemAndSettings)();null==s||s.step(`Processing ${a||"DIRECT"} referral structure`);let l;switch(a){case"DIRECT":default:l=await(0,utils_1.listDirectReferrals)(i,s);break;case"BINARY":l=await(0,utils_1.listBinaryReferrals)(i,o,s);break;case"UNILEVEL":l=await(0,utils_1.listUnilevelReferrals)(i,o,s)}null==s||s.success("Node details retrieved successfully");return l};