"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),errors_1=require("@b/utils/schema/errors");exports.metadata={summary:"Update gateway merchant status",description:"Updates the operational status of a gateway merchant account. Status determines whether the merchant can process payments: PENDING (awaiting approval), ACTIVE (can process payments), SUSPENDED (temporarily disabled), or REJECTED (permanently denied).",operationId:"updateGatewayMerchantStatus",tags:["Admin","Gateway","Merchant"],parameters:[{name:"id",in:"path",required:!0,description:"Merchant UUID",schema:{type:"string",format:"uuid"}}],requestBody:{required:!0,content:{"application/json":{schema:{type:"object",properties:{status:{type:"string",enum:["PENDING","ACTIVE","SUSPENDED","REJECTED"],description:"New merchant status"}},required:["status"]}}}},responses:{200:{description:"Merchant status updated successfully",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"},merchant:{type:"object",properties:{id:{type:"string"},name:{type:"string"},status:{type:"string"}}}}}}}},400:errors_1.badRequestResponse,401:errors_1.unauthorizedResponse,404:(0,errors_1.notFoundResponse)("Merchant"),500:errors_1.serverErrorResponse},requiresAuth:!0,permission:"edit.gateway.merchant",logModule:"ADMIN_GATEWAY",logTitle:"Update merchant status"};exports.default=async e=>{const{params:t,body:s,ctx:a}=e,{id:r}=t,{status:n}=s;null==a||a.step(`Validating status for merchant ${r}`);const o=["PENDING","ACTIVE","SUSPENDED","REJECTED"];if(!o.includes(n)){null==a||a.fail(`Invalid status: ${n}`);throw(0,error_1.createError)({statusCode:400,message:`Invalid status. Must be one of: ${o.join(", ")}`})}null==a||a.step(`Finding merchant ${r}`);const i=await db_1.models.gatewayMerchant.findByPk(r);if(!i){null==a||a.fail("Merchant not found");throw(0,error_1.createError)({statusCode:404,message:"Merchant not found"})}null==a||a.step(`Updating merchant status to ${n}`);await i.update({status:n});null==a||a.success(`Merchant status updated to ${n}`);return{message:`Merchant status updated to ${n}`,merchant:{id:i.id,name:i.name,status:i.status}}};