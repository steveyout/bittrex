"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),errors_1=require("@b/utils/schema/errors");exports.metadata={summary:"Update gateway merchant verification",description:"Updates the verification status of a gateway merchant account. Verification status indicates whether the merchant's identity and business documentation has been reviewed: UNVERIFIED (no verification submitted), PENDING (under review), or VERIFIED (approved).",operationId:"updateGatewayMerchantVerification",tags:["Admin","Gateway","Merchant"],parameters:[{name:"id",in:"path",required:!0,description:"Merchant UUID",schema:{type:"string",format:"uuid"}}],requestBody:{required:!0,content:{"application/json":{schema:{type:"object",properties:{verificationStatus:{type:"string",enum:["UNVERIFIED","PENDING","VERIFIED"],description:"New verification status"}},required:["verificationStatus"]}}}},responses:{200:{description:"Verification status updated successfully",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"},merchant:{type:"object",properties:{id:{type:"string"},name:{type:"string"},verificationStatus:{type:"string"}}}}}}}},400:errors_1.badRequestResponse,401:errors_1.unauthorizedResponse,404:(0,errors_1.notFoundResponse)("Merchant"),500:errors_1.serverErrorResponse},requiresAuth:!0,permission:"edit.gateway.merchant",logModule:"ADMIN_GATEWAY",logTitle:"Update merchant verification"};exports.default=async e=>{const{params:t,body:r,ctx:i}=e,{id:a}=t,{verificationStatus:s}=r;null==i||i.step(`Validating verification status for merchant ${a}`);const n=["UNVERIFIED","PENDING","VERIFIED"];if(!n.includes(s)){null==i||i.fail(`Invalid verification status: ${s}`);throw(0,error_1.createError)({statusCode:400,message:`Invalid status. Must be one of: ${n.join(", ")}`})}null==i||i.step(`Finding merchant ${a}`);const o=await db_1.models.gatewayMerchant.findByPk(a);if(!o){null==i||i.fail("Merchant not found");throw(0,error_1.createError)({statusCode:404,message:"Merchant not found"})}null==i||i.step(`Updating verification status to ${s}`);await o.update({verificationStatus:s});null==i||i.success(`Merchant verification updated to ${s}`);return{message:`Merchant verification updated to ${s}`,merchant:{id:o.id,name:o.name,verificationStatus:o.verificationStatus}}};