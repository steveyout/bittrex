"use strict";async function handleOrderBookBroadcast(e,r){try{if(!r){console_1.logger.error("FUTURES_WS","Book is undefined",new Error("Book is undefined"));return}if(!fromWei){console_1.logger.warn("FUTURES_WS","Ecosystem extension not available for order book broadcast");return}const o=1e-10,t={asks:Object.entries(r.asks||{}).map(([e,r])=>[fromWei(Number(e)),fromWei(Number(r))]).filter(([e,r])=>e>o&&r>o),bids:Object.entries(r.bids||{}).map(([e,r])=>[fromWei(Number(e)),fromWei(Number(r))]).filter(([e,r])=>e>o&&r>o)};Websocket_1.messageBroker.broadcastToSubscribedClients("/api/futures/market",{type:"orderbook",symbol:e},{stream:"orderbook",data:t})}catch(e){console_1.logger.error("FUTURES_WS","Failed to fetch and broadcast order book",e)}}async function handleOrderBroadcast(e){if(!fromBigInt){console_1.logger.warn("FUTURES_WS","Ecosystem extension not available for order broadcast");return}const r={...e,price:fromBigInt(e.price),amount:fromBigInt(e.amount),filled:fromBigInt(e.filled),remaining:fromBigInt(e.remaining),cost:fromBigInt(e.cost),fee:fromBigInt(e.fee),average:fromBigInt(e.average),leverage:fromBigInt(e.leverage),stopLossPrice:e.stopLossPrice?fromBigInt(e.stopLossPrice):void 0,takeProfitPrice:e.takeProfitPrice?fromBigInt(e.takeProfitPrice):void 0};Websocket_1.messageBroker.broadcastToSubscribedClients("/api/futures/order",{type:"orders",userId:e.userId},{stream:"orders",data:[r]});Websocket_1.messageBroker.broadcastToSubscribedClients(`/api/futures/market/${e.symbol}`,{type:"orders",userId:e.userId},{stream:"orders",data:r})}async function handleTradesBroadcast(e,r){Websocket_1.messageBroker.broadcastToSubscribedClients("/api/futures/market",{type:"trades",symbol:e},{stream:"trades",data:r})}async function handleTickerBroadcast(e,r){Websocket_1.messageBroker.broadcastToSubscribedClients("/api/futures/market",{type:"ticker",symbol:e},{stream:"ticker",data:r})}async function handleCandleBroadcast(e,r,o){if(!o||!o.createdAt){console_1.logger.error("FUTURES_WS","Candle data or createdAt property is missing",new Error("Missing candle data"));return}const t=[new Date(o.createdAt).getTime(),o.open,o.high,o.low,o.close,o.volume];Websocket_1.messageBroker.broadcastToSubscribedClients("/api/futures/market",{type:"ohlcv",interval:r,symbol:e},{stream:"ohlcv",data:[t]})}async function handleTickersBroadcast(e){Websocket_1.messageBroker.broadcastToSubscribedClients("/api/futures/ticker",{type:"tickers"},{stream:"tickers",data:e})}async function handlePositionBroadcast(e){if(!fromBigInt){console_1.logger.warn("FUTURES_WS","Ecosystem extension not available for position broadcast");return}const r={...e,entryPrice:fromBigInt(e.entryPrice),amount:fromBigInt(e.amount),unrealizedPnl:fromBigInt(e.unrealizedPnl),stopLossPrice:e.stopLossPrice?fromBigInt(e.stopLossPrice):void 0,takeProfitPrice:e.takeProfitPrice?fromBigInt(e.takeProfitPrice):void 0};Websocket_1.messageBroker.broadcastToSubscribedClients(`/api/futures/market/${e.symbol}`,{type:"positions",userId:e.userId},{stream:"positions",data:r})}Object.defineProperty(exports,"__esModule",{value:!0});exports.handleOrderBookBroadcast=handleOrderBookBroadcast;exports.handleOrderBroadcast=handleOrderBroadcast;exports.handleTradesBroadcast=handleTradesBroadcast;exports.handleTickerBroadcast=handleTickerBroadcast;exports.handleCandleBroadcast=handleCandleBroadcast;exports.handleTickersBroadcast=handleTickersBroadcast;exports.handlePositionBroadcast=handlePositionBroadcast;const Websocket_1=require("@b/handler/Websocket"),console_1=require("@b/utils/console");let fromBigInt,fromWei;try{const e=require("../../ecosystem/utils/blockchain");fromBigInt=e.fromBigInt;fromWei=e.fromWei}catch(e){}