"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const Websocket_1=require("@b/handler/Websocket"),matchingEngine_1=require("@b/api/(ext)/futures/utils/matchingEngine");exports.metadata={logModule:"FUTURES",logTitle:"Futures ticker websocket"};exports.default=async(e,t)=>{var s,i,a,c;const{ctx:l}=e;"string"==typeof t&&(t=JSON.parse(t));null===(s=null==l?void 0:l.step)||void 0===s||s.call(l,"Initializing futures matching engine");const n=await matchingEngine_1.FuturesMatchingEngine.getInstance();null===(i=null==l?void 0:l.step)||void 0===i||i.call(l,"Fetching all futures tickers");const r=await n.getTickers();null===(a=null==l?void 0:l.step)||void 0===a||a.call(l,"Broadcasting tickers to subscribed clients");Websocket_1.messageBroker.broadcastToSubscribedClients("/api/futures/ticker",{type:"tickers"},{stream:"tickers",data:r});null===(c=null==l?void 0:l.success)||void 0===c||c.call(l,"Ticker data broadcasted successfully")};