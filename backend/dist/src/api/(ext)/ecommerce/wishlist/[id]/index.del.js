"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),query_1=require("@b/utils/query");exports.metadata={summary:"Removes a product from the user's wishlist",description:"Allows a user to remove a product from their wishlist.",operationId:"removeFromEcommerceWishlist",tags:["Ecommerce","Wishlist"],logModule:"ECOM",logTitle:"Remove from wishlist",parameters:[{index:0,name:"id",in:"path",required:!0,schema:{type:"string",description:"Product ID to be removed from the wishlist"}}],responses:(0,query_1.deleteRecordResponses)("Wishlist"),requiresAuth:!0};exports.default=async e=>{const{user:s,params:r,ctx:t}=e;if(!(null==s?void 0:s.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});const{id:i}=r;null==t||t.step("Finding user wishlist");const o=await db_1.models.ecommerceWishlist.findOne({where:{userId:s.id}});if(!o){null==t||t.fail("Wishlist not found");throw(0,error_1.createError)({statusCode:404,message:"Wishlist not found"})}null==t||t.step("Removing product from wishlist");if(!await db_1.models.ecommerceWishlistItem.destroy({where:{wishlistId:o.id,productId:i},force:!0})){null==t||t.fail("Product not found in wishlist");throw(0,error_1.createError)({statusCode:404,message:"Product not found in wishlist"})}null==t||t.step("Checking if wishlist is empty");if(0===(await db_1.models.ecommerceWishlistItem.findAll({where:{wishlistId:o.id}})).length){null==t||t.step("Removing empty wishlist");await db_1.models.ecommerceWishlist.destroy({where:{id:o.id},force:!0})}null==t||t.success(`Product ${i} removed from wishlist`);return{message:"Product removed from wishlist successfully"}};