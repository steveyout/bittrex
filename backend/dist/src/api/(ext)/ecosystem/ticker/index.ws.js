"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const Websocket_1=require("@b/handler/Websocket"),matchingEngine_1=require("@b/api/(ext)/ecosystem/utils/matchingEngine");exports.metadata={logModule:"ECOSYSTEM",logTitle:"Ticker WebSocket connection"};exports.default=async(e,t)=>{const{ctx:s}=e;null==s||s.step("Processing ticker WebSocket message");"string"==typeof t&&(t=JSON.parse(t));null==s||s.step("Fetching tickers from matching engine");const c=await matchingEngine_1.MatchingEngine.getInstance(),i=await c.getTickers();null==s||s.step("Broadcasting tickers to subscribers");Websocket_1.messageBroker.broadcastToSubscribedClients("/api/ecosystem/ticker",{type:"tickers"},{stream:"tickers",data:i});null==s||s.success(`Broadcasted ${Object.keys(i||{}).length} tickers`)};