"use strict";async function getSmartContract(r,e){const t=process.cwd(),o=t.endsWith("backend"),s=path_1.default.resolve(t,o?`ecosystem/smart-contracts/${r}/${e}.json`:`backend/ecosystem/smart-contracts/${r}/${e}.json`);try{const r=fs_1.default.readFileSync(s,"utf8"),t=JSON.parse(r),{abi:o,bytecode:a}=t;if(!a||!o)throw(0,error_1.createError)({statusCode:404,message:`Failed to extract bytecode or ABI for ${e}`});return{abi:o,bytecode:a}}catch(r){console_1.logger.error("SMART_CONTRACT",`Failed to read contract JSON for ${e}`,r);throw r}}var __importDefault=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(exports,"__esModule",{value:!0});exports.getContractAbi=void 0;exports.getSmartContract=getSmartContract;const fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),chains_1=require("./chains"),console_1=require("@b/utils/console"),error_1=require("@b/utils/error"),getContractAbi=async(r,e,t)=>{const o=chains_1.chainConfigs[r];if(!o)throw(0,error_1.createError)({statusCode:400,message:`Unsupported chain: ${r}`});const s=process.env[`${r}_EXPLORER_API_KEY`];if(!s)throw(0,error_1.createError)({statusCode:500,message:`API Key for ${r} is not set`});const a=o.networks[e];if(!a||!a.explorer)throw(0,error_1.createError)({statusCode:400,message:`Unsupported network: ${e} for chain: ${r}`});const c=a.chainId?`&chainid=${a.chainId}`:"",n=`https://${a.explorer}/v2/api?module=contract&action=getabi&address=${t}${c}&apikey=${s}`;try{const r=await fetch(n),e=await r.json();if("0"===e.status&&"NOTOK"===e.message){console_1.logger.warn("CONTRACT_ABI",`Etherscan API error for contract ABI ${t}: ${e.result}`);throw(0,error_1.createError)({statusCode:404,message:`Contract ABI not available: ${e.result}`})}if("1"!==e.status)throw(0,error_1.createError)({statusCode:500,message:`API Error: ${e.message}`});return e.result}catch(r){console_1.logger.error("CONTRACT_ABI","Failed to fetch contract ABI",r);throw(0,error_1.createError)({statusCode:500,message:`Failed to fetch contract ABI: ${r.message}`})}};exports.getContractAbi=getContractAbi;