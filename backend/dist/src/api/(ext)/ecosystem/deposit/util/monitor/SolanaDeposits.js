"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.SolanaDeposits=void 0;const safe_imports_1=require("@b/utils/safe-imports"),tokens_1=require("@b/api/(ext)/ecosystem/utils/tokens"),error_1=require("@b/utils/error");class SolanaDeposits{constructor(t){this.active=!0;this.wallet=t.wallet;this.chain=t.chain;this.currency=t.currency;this.address=t.address}async watchDeposits(){const t=await(0,safe_imports_1.getSolanaService)();if(!t)throw(0,error_1.createError)({statusCode:503,message:"Solana service not available"});const s=await t.getInstance();if("SOL"===this.currency)await s.monitorSolanaDeposits(this.wallet,this.address,()=>this.stopPolling());else{const t=await(0,tokens_1.getEcosystemToken)(this.chain,this.currency);if(!t||!t.contract){console.error(`SPL Token ${this.currency} not found or invalid mint address`);return}await s.monitorSPLTokenDeposits(this.wallet,this.address,t.contract,()=>this.stopPolling())}}stopPolling(){this.active=!1;console.log(`Monitor for wallet ${this.wallet.id} has stopped polling.`)}}exports.SolanaDeposits=SolanaDeposits;