"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error");exports.metadata={summary:"Get Staking Position Earnings",description:"Retrieves all earnings records for a specific staking position.",operationId:"getStakingPositionEarnings",tags:["Staking","Positions","Earnings"],requiresAuth:!0,parameters:[{index:0,name:"id",in:"path",required:!0,schema:{type:"string"},description:"Position ID"},{index:1,name:"claimed",in:"query",required:!1,schema:{type:"boolean"},description:"Filter by claimed status"}],responses:{200:{description:"Earnings retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{earnings:{type:"array",items:{type:"object"}},summary:{type:"object",properties:{total:{type:"number"},claimed:{type:"number"},unclaimed:{type:"number"}}}}}}}},401:{description:"Unauthorized"},403:{description:"Forbidden - Not position owner"},404:{description:"Position not found"},500:{description:"Internal Server Error"}}};exports.default=async e=>{const{user:i,params:r,query:t,ctx:o}=e;if(!(null==i?void 0:i.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});const{id:s}=r;null==o||o.step(`Fetching earnings for position ${s}`);const n=await db_1.models.stakingPosition.findOne({where:{id:s},include:[{model:db_1.models.stakingPool,as:"pool"}]});if(!n)throw(0,error_1.createError)({statusCode:404,message:"Position not found"});if(n.userId!==i.id)throw(0,error_1.createError)({statusCode:403,message:"You don't have access to this position"});const a={positionId:n.id};void 0!==t.claimed&&(a.isClaimed="true"===t.claimed);const d=await db_1.models.stakingEarningRecord.findAll({where:a,order:[["createdAt","DESC"]]}),c=d.reduce((e,i)=>e+i.amount,0),u=d.filter(e=>e.isClaimed).reduce((e,i)=>e+i.amount,0),l=c-u;null==o||o.success(`Retrieved ${d.length} earnings for position ${s}`);return{earnings:d,summary:{total:c,claimed:u,unclaimed:l,tokenSymbol:n.pool.symbol}}};