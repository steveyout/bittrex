"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),sequelize_1=require("sequelize");exports.metadata={summary:"Get Staking Pool Details",description:"Retrieves detailed information about a specific staking pool.",operationId:"getStakingPoolById",tags:["Staking","Pools"],requiresAuth:!0,parameters:[{index:0,name:"id",in:"path",required:!0,schema:{type:"string"},description:"Pool ID"}],responses:{200:{description:"Pool details retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{pool:{type:"object"}}}}}},401:{description:"Unauthorized"},404:{description:"Pool not found"},500:{description:"Internal Server Error"}}};exports.default=async e=>{const{user:t,params:o}=e;if(!(null==t?void 0:t.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});const{id:r}=o,i=await db_1.models.stakingPool.findOne({where:{id:r}});if(!i)throw(0,error_1.createError)({statusCode:404,message:"Pool not found"});const s=await db_1.models.stakingPosition.findOne({attributes:[[(0,sequelize_1.fn)("SUM",(0,sequelize_1.col)("amount")),"totalStaked"],[(0,sequelize_1.fn)("COUNT",(0,sequelize_1.fn)("DISTINCT",(0,sequelize_1.col)("userId"))),"totalStakers"]],where:{poolId:i.id,status:{[sequelize_1.Op.in]:["ACTIVE","COMPLETED"]}},raw:!0}),a=(null==s?void 0:s.totalStaked)?parseFloat(s.totalStaked):0,n=(null==s?void 0:s.totalStakers)?parseInt(s.totalStakers):0,d=await db_1.models.stakingPosition.findAll({where:{poolId:i.id,userId:t.id,status:{[sequelize_1.Op.in]:["ACTIVE","COMPLETED","PENDING_WITHDRAWAL"]}}}),l=d.reduce((e,t)=>e+t.amount,0),u=await db_1.models.stakingExternalPoolPerformance.findAll({where:{poolId:i.id},order:[["date","DESC"]],limit:30});return{...i.toJSON(),totalStaked:a,analytics:{totalStakers:n,userTotalStaked:l,userPositionsCount:d.length,performanceHistory:u},userPositions:d}};