"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),sequelize_1=require("sequelize"),query_1=require("@b/utils/query"),error_1=require("@b/utils/error");exports.metadata={summary:"Get P2P Transactions",description:"Retrieves recent trade transactions for the authenticated user.",operationId:"getP2PTransactions",tags:["P2P","Dashboard"],logModule:"P2P",logTitle:"Get transactions",responses:{200:{description:"Transactions retrieved successfully."},401:query_1.unauthorizedResponse,500:query_1.serverErrorResponse},requiresAuth:!0};exports.default=async e=>{const{user:r,ctx:t}=e;if(!(null==r?void 0:r.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});null==t||t.step("Fetching recent transactions");try{const e=await db_1.models.p2pTrade.findAll({where:{[sequelize_1.Op.or]:[{buyerId:r.id},{sellerId:r.id}]},order:[["createdAt","DESC"]],limit:10,raw:!0});null==t||t.success(`Retrieved ${e.length} transactions`);return e}catch(e){null==t||t.fail(e.message||"Failed to retrieve transactions");throw(0,error_1.createError)({statusCode:500,message:"Internal Server Error: "+e.message})}};