"use strict";async function handler(e){const{user:r,ctx:t}=e;if(!r)throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});null==t||t.step("Validating and sanitizing pagination parameters");const a=Math.max(1,Math.min(parseInt(e.query.page||"1",10)||1,1e3)),s=Math.max(1,Math.min(parseInt(e.query.perPage||"10",10)||10,100));null==t||t.step(`Fetching referrals (page ${a}, ${s} per page)`);const{count:i,rows:l}=await db_1.models.mlmReferral.findAndCountAll({where:{referrerId:r.id},include:[{model:db_1.models.user,as:"referred",attributes:["id","firstName","lastName","email","avatar"]}],order:[["createdAt","DESC"]],offset:(a-1)*s,limit:s});null==t||t.success(`Retrieved ${l.length} referrals (total: ${i})`);return{referrals:l,pagination:{page:a,perPage:s,totalItems:i,totalPages:Math.ceil(i/s)}}}Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;exports.default=handler;const db_1=require("@b/db"),error_1=require("@b/utils/error");exports.metadata={summary:"List referrals for authenticated affiliate",operationId:"listAffiliateReferrals",tags:["Affiliate","Referral"],requiresAuth:!0,logModule:"AFFILIATE",logTitle:"List affiliate referrals",parameters:[{name:"page",in:"query",required:!1,schema:{type:"number"}},{name:"perPage",in:"query",required:!1,schema:{type:"number"}}],responses:{200:{description:"Referral list retrieved successfully."},401:{description:"Unauthorized"},500:{description:"Internal Server Error"}}};