"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error");exports.metadata={summary:"Get Subscription Details",description:"Retrieves detailed information about a specific subscription.",operationId:"getCopyTradingSubscription",tags:["Copy Trading","Followers"],requiresAuth:!0,logModule:"COPY",logTitle:"Get subscription details",parameters:[{name:"id",in:"path",required:!0,schema:{type:"string"},description:"Subscription ID"}],responses:{200:{description:"Subscription details retrieved successfully",content:{"application/json":{schema:{type:"object"}}}},401:{description:"Unauthorized"},403:{description:"Forbidden"},404:{description:"Subscription not found"},500:{description:"Internal Server Error"}}};exports.default=async e=>{const{user:r,params:t,ctx:i}=e,{id:s}=t;if(!(null==r?void 0:r.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});null==i||i.step("Fetching subscription");const o=await db_1.models.copyTradingFollower.findByPk(s,{include:[{model:db_1.models.copyTradingLeader,as:"leader",include:[{model:db_1.models.user,as:"user",attributes:["id","firstName","lastName","avatar"]}]}]});if(!o)throw(0,error_1.createError)({statusCode:404,message:"Subscription not found"});if(o.userId!==r.id)throw(0,error_1.createError)({statusCode:403,message:"Access denied"});null==i||i.step("Fetching recent trades");const a=await db_1.models.copyTradingTrade.findAll({where:{followerId:s},order:[["createdAt","DESC"]],limit:20});null==i||i.step("Fetching transactions");const d=await db_1.models.copyTradingTransaction.findAll({where:{followerId:s},order:[["createdAt","DESC"]],limit:20});null==i||i.success("Subscription details retrieved");return{...o.toJSON(),recentTrades:a.map(e=>e.toJSON()),transactions:d.map(e=>e.toJSON())}};