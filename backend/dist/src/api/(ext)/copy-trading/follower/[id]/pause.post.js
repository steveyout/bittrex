"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),utils_1=require("@b/api/(ext)/copy-trading/utils"),security_1=require("@b/api/(ext)/copy-trading/utils/security");exports.metadata={summary:"Pause Subscription",description:"Pauses a subscription, stopping new trades from being copied.",operationId:"pauseCopyTradingSubscription",tags:["Copy Trading","Followers"],requiresAuth:!0,logModule:"COPY",logTitle:"Pause subscription",middleware:["copyTradingFollowerAction"],parameters:[{name:"id",in:"path",required:!0,schema:{type:"string",format:"uuid"},description:"Subscription ID"}],responses:{200:{description:"Subscription paused successfully",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"},subscription:{type:"object"}}}}}},400:{description:"Bad Request"},401:{description:"Unauthorized"},403:{description:"Forbidden"},404:{description:"Subscription not found"},429:{description:"Too Many Requests"},500:{description:"Internal Server Error"}}};exports.default=async e=>{const{user:s,params:t,ctx:r}=e,{id:i}=t;if(!(null==s?void 0:s.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});if(!(0,security_1.isValidUUID)(i))throw(0,error_1.createError)({statusCode:400,message:"Invalid subscription ID"});null==r||r.step("Fetching subscription");const o=await db_1.models.copyTradingFollower.findByPk(i);if(!o)throw(0,error_1.createError)({statusCode:404,message:"Subscription not found"});if(o.userId!==s.id)throw(0,error_1.createError)({statusCode:403,message:"Access denied"});if("ACTIVE"!==o.status)throw(0,error_1.createError)({statusCode:400,message:"Only active subscriptions can be paused"});null==r||r.step("Pausing subscription");const a=o.status;await o.update({status:"PAUSED"});await(0,utils_1.createAuditLog)({entityType:"FOLLOWER",entityId:i,action:"PAUSE",oldValue:{status:a},newValue:{status:"PAUSED"},userId:s.id});null==r||r.step("Sending notification");await(0,utils_1.notifyFollowerSubscriptionEvent)(i,"PAUSED",void 0,r);null==r||r.success("Subscription paused");return{message:"Subscription paused successfully",subscription:o.toJSON()}};