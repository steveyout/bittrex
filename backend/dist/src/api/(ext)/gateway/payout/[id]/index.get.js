"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error");exports.metadata={summary:"Get payout details",description:"Gets detailed information about a specific payout for the current merchant.",operationId:"getMerchantPayoutDetails",tags:["Gateway","Merchant","Payouts"],parameters:[{name:"id",in:"path",required:!0,description:"Payout ID",schema:{type:"string"}}],responses:{200:{description:"Payout details"}},requiresAuth:!0,logModule:"GATEWAY",logTitle:"Get Payout"};exports.default=async e=>{const{user:t,params:r,ctx:a}=e,{id:d}=r;if(!(null==t?void 0:t.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});const o=await db_1.models.gatewayMerchant.findOne({where:{userId:t.id}});if(!o)throw(0,error_1.createError)({statusCode:404,message:"Merchant account not found"});const n=await db_1.models.gatewayPayout.findOne({where:{[db_1.models.Sequelize.Op.or]:[{payoutId:d},{id:d}],merchantId:o.id}});if(!n)throw(0,error_1.createError)({statusCode:404,message:"Payout not found"});const u=await db_1.models.gatewayPayment.findAll({where:{merchantId:o.id,status:"COMPLETED",createdAt:{[db_1.models.Sequelize.Op.between]:[n.periodStart,n.periodEnd]}},attributes:["id","paymentIntentId","amount","currency","createdAt"],order:[["createdAt","DESC"]],limit:50}),s=await db_1.models.gatewayRefund.findAll({where:{merchantId:o.id,status:"COMPLETED",createdAt:{[db_1.models.Sequelize.Op.between]:[n.periodStart,n.periodEnd]}},attributes:["id","refundId","amount","currency","createdAt"],order:[["createdAt","DESC"]],limit:50});null==a||a.success("Request completed successfully");return{id:n.payoutId,amount:n.amount,currency:n.currency,walletType:n.walletType,status:n.status,periodStart:n.periodStart,periodEnd:n.periodEnd,grossAmount:n.grossAmount,feeAmount:n.feeAmount,netAmount:n.netAmount,paymentCount:n.paymentCount,refundCount:n.refundCount,metadata:n.metadata,createdAt:n.createdAt,updatedAt:n.updatedAt,payments:u.map(e=>({id:e.paymentIntentId,amount:e.amount,currency:e.currency,createdAt:e.createdAt})),refunds:s.map(e=>({id:e.refundId,amount:e.amount,currency:e.currency,createdAt:e.createdAt}))}};