"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),query_1=require("@b/utils/query");exports.metadata={summary:"List payouts",description:"Lists all payouts for the current merchant.",operationId:"listMerchantPayouts",tags:["Gateway","Merchant","Payouts"],parameters:[{name:"status",in:"query",schema:{type:"string"}},{name:"page",in:"query",schema:{type:"integer",default:1}},{name:"perPage",in:"query",schema:{type:"integer",default:10}}],responses:{200:{description:"List of payouts"}},requiresAuth:!0,logModule:"GATEWAY",logTitle:"Get Payouts"};exports.default=async e=>{const{user:t,query:r,ctx:a}=e;if(!(null==t?void 0:t.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});const s=await db_1.models.gatewayMerchant.findOne({where:{userId:t.id}});if(!s)throw(0,error_1.createError)({statusCode:404,message:"Merchant account not found"});const o={merchantId:s.id};r.status&&(o.status=r.status);const u=await(0,query_1.getFiltered)({model:db_1.models.gatewayPayout,query:r,where:o,sortField:"createdAt",paranoid:!1});null==a||a.success("Request completed successfully");return{items:u.items.map(e=>({id:e.payoutId,amount:e.amount,currency:e.currency,walletType:e.walletType,status:e.status,periodStart:e.periodStart,periodEnd:e.periodEnd,grossAmount:e.grossAmount,feeAmount:e.feeAmount,netAmount:e.netAmount,paymentCount:e.paymentCount,refundCount:e.refundCount,createdAt:e.createdAt})),pagination:u.pagination}};