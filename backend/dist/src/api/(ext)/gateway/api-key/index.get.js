"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error");exports.metadata={summary:"List API keys",description:"Lists all API keys for the current merchant.",operationId:"listApiKeys",tags:["Gateway","Merchant","API Keys"],parameters:[{name:"mode",in:"query",description:"Filter by mode (LIVE or TEST)",schema:{type:"string",enum:["LIVE","TEST"]}}],responses:{200:{description:"List of API keys"},404:{description:"Merchant not found"}},requiresAuth:!0,logModule:"GATEWAY",logTitle:"Get API Keys"};exports.default=async e=>{const{user:t,query:s,ctx:r}=e;if(!(null==t?void 0:t.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});const o=await db_1.models.gatewayMerchant.findOne({where:{userId:t.id}});if(!o)throw(0,error_1.createError)({statusCode:404,message:"Merchant account not found"});const a={merchantId:o.id},i=null==s?void 0:s.mode;i&&(a.mode=i);const d=await db_1.models.gatewayApiKey.findAll({where:a,order:[["mode","ASC"],["type","ASC"],["createdAt","DESC"]]});null==r||r.success("Request completed successfully");return d.map(e=>({id:e.id,name:e.name,keyPreview:`${e.keyPrefix}...${e.lastFourChars}`,type:e.type,mode:e.mode,permissions:e.permissions,allowedWalletTypes:e.allowedWalletTypes,ipWhitelist:e.ipWhitelist,successUrl:e.successUrl,cancelUrl:e.cancelUrl,webhookUrl:e.webhookUrl,status:e.status,lastUsedAt:e.lastUsedAt,lastUsedIp:e.lastUsedIp,expiresAt:e.expiresAt,createdAt:e.createdAt}))};