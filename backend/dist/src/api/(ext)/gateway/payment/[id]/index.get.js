"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error");exports.metadata={summary:"Get payment details",description:"Gets detailed payment information for merchants.",operationId:"getMerchantPayment",tags:["Gateway","Merchant","Payments"],parameters:[{name:"id",in:"path",required:!0,schema:{type:"string"}}],responses:{200:{description:"Payment details"},404:{description:"Payment not found"}},requiresAuth:!0,logModule:"GATEWAY",logTitle:"Get Payment",demoMask:["customerEmail"]};exports.default=async e=>{var t;const{user:a,params:r,ctx:s}=e,{id:n}=r;if(!(null==a?void 0:a.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});const o=await db_1.models.gatewayMerchant.findOne({where:{userId:a.id}});if(!o)throw(0,error_1.createError)({statusCode:404,message:"Merchant account not found"});const d=await db_1.models.gatewayPayment.findOne({where:{paymentIntentId:n,merchantId:o.id},include:[{model:db_1.models.gatewayRefund,as:"gatewayRefunds",attributes:["refundId","amount","status","reason","createdAt"]}]});if(!d)throw(0,error_1.createError)({statusCode:404,message:"Payment not found"});null==s||s.success("Request completed successfully");return{id:d.paymentIntentId,orderId:d.merchantOrderId,amount:d.amount,currency:d.currency,walletType:d.walletType,feeAmount:d.feeAmount,netAmount:d.netAmount,status:d.status,description:d.description,metadata:d.metadata,allocations:d.allocations,lineItems:d.lineItems,customerEmail:d.customerEmail,customerName:d.customerName,billingAddress:d.billingAddress,testMode:d.testMode,expiresAt:d.expiresAt,completedAt:d.completedAt,createdAt:d.createdAt,refunds:null===(t=d.gatewayRefunds)||void 0===t?void 0:t.map(e=>({id:e.refundId,amount:e.amount,status:e.status,reason:e.reason,createdAt:e.createdAt}))}};