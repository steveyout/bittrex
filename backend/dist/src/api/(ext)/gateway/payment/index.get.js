"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),query_1=require("@b/utils/query");exports.metadata={summary:"List payments",description:"Lists all payments for the current merchant.",operationId:"listMerchantPayments",tags:["Gateway","Merchant","Payments"],parameters:[{name:"mode",in:"query",description:"Filter by mode (LIVE or TEST)",schema:{type:"string",enum:["LIVE","TEST"]}},{name:"status",in:"query",schema:{type:"string"},description:"Filter by status"},{name:"page",in:"query",schema:{type:"integer",default:1}},{name:"perPage",in:"query",schema:{type:"integer",default:10}},{name:"sortField",in:"query",schema:{type:"string",default:"createdAt"}},{name:"sortOrder",in:"query",schema:{type:"string",default:"desc"}}],responses:{200:{description:"List of payments"}},requiresAuth:!0,logModule:"GATEWAY",logTitle:"Get Payments",demoMask:["items.customerEmail"]};exports.default=async e=>{const{user:t,query:r,ctx:s}=e;if(!(null==t?void 0:t.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});const a=await db_1.models.gatewayMerchant.findOne({where:{userId:t.id}});if(!a)throw(0,error_1.createError)({statusCode:404,message:"Merchant account not found"});const n={merchantId:a.id},o=r.mode;n.testMode="TEST"===o;r.status&&(n.status=r.status);const u=await(0,query_1.getFiltered)({model:db_1.models.gatewayPayment,query:r,where:n,sortField:r.sortField||"createdAt"});null==s||s.success("Request completed successfully");return{items:u.items.map(e=>({id:e.paymentIntentId,orderId:e.merchantOrderId,amount:e.amount,currency:e.currency,walletType:e.walletType,feeAmount:e.feeAmount,netAmount:e.netAmount,status:e.status,customerEmail:e.customerEmail,customerName:e.customerName,testMode:e.testMode,createdAt:e.createdAt,completedAt:e.completedAt})),pagination:u.pagination}};