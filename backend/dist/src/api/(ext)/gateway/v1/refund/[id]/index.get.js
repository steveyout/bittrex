"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),gateway_1=require("@b/utils/gateway"),utils_1=require("../../utils");exports.metadata={summary:"Get refund details",description:"Retrieves the details of an existing refund by its ID.",operationId:"getRefund",tags:["Gateway","Refund"],parameters:[{name:"id",in:"path",required:!0,description:"Refund ID (e.g., re_xxx)",schema:{type:"string"}}],responses:{200:{description:"Refund details",content:{"application/json":{schema:utils_1.refundResponseSchema}}},401:{description:"Invalid or missing API key"},404:{description:"Refund not found"}},requiresAuth:!1,logModule:"GATEWAY",logTitle:"Get Refund V1"};exports.default=async e=>{var t,n,r;const{params:a,headers:i,ctx:d}=e,{id:s}=a,o=(null==i?void 0:i["x-api-key"])||(null==i?void 0:i["X-API-Key"]),u=(null===(n=null===(t=null==i?void 0:i["x-forwarded-for"])||void 0===t?void 0:t.split(",")[0])||void 0===n?void 0:n.trim())||(null==i?void 0:i["x-real-ip"])||(null==i?void 0:i["cf-connecting-ip"])||null,{merchant:l,apiKey:c}=await(0,gateway_1.authenticateGatewayApi)(o,u);(0,gateway_1.checkApiPermission)(c,"refund.read");const p=await db_1.models.gatewayRefund.findOne({where:{refundId:s,merchantId:l.id},include:[{model:db_1.models.gatewayPayment,as:"payment",attributes:["paymentIntentId"]}]});if(!p)throw(0,error_1.createError)({statusCode:404,message:"Refund not found"});null==d||d.success("Request completed successfully");return{id:p.refundId,paymentId:null===(r=p.payment)||void 0===r?void 0:r.paymentIntentId,amount:p.amount,currency:p.currency,status:p.status,reason:p.reason,description:p.description,createdAt:p.createdAt}};