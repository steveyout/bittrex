"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),gateway_1=require("@b/utils/gateway"),utils_1=require("../../utils");exports.metadata={summary:"Get payment details",description:"Retrieves the details of an existing payment by its ID.",operationId:"getPayment",tags:["Gateway","Payment"],parameters:[{name:"id",in:"path",required:!0,description:"Payment intent ID (e.g., pi_xxx)",schema:{type:"string"}}],responses:{200:{description:"Payment details",content:{"application/json":{schema:utils_1.paymentResponseSchema}}},401:{description:"Invalid or missing API key"},404:{description:"Payment not found"}},requiresAuth:!1,logModule:"GATEWAY",logTitle:"Get Payment V1"};exports.default=async e=>{var t,a;const{params:r,headers:n,ctx:i}=e,{id:s}=r,o=(null==n?void 0:n["x-api-key"])||(null==n?void 0:n["X-API-Key"]),d=(null===(a=null===(t=null==n?void 0:n["x-forwarded-for"])||void 0===t?void 0:t.split(",")[0])||void 0===a?void 0:a.trim())||(null==n?void 0:n["x-real-ip"])||(null==n?void 0:n["cf-connecting-ip"])||null,{merchant:m,apiKey:u,isTestMode:c}=await(0,gateway_1.authenticateGatewayApi)(o,d);(0,gateway_1.checkApiPermission)(u,"payment.read");const l=await db_1.models.gatewayPayment.findOne({where:{paymentIntentId:s,merchantId:m.id}});if(!l)throw(0,error_1.createError)({statusCode:404,message:"Payment not found"});if(l.testMode!==c)throw(0,error_1.createError)({statusCode:404,message:"Payment not found"});null==i||i.success("Request completed successfully");return{id:l.paymentIntentId,status:l.status,amount:l.amount,currency:l.currency,walletType:l.walletType,merchantOrderId:l.merchantOrderId,description:l.description,feeAmount:l.feeAmount,netAmount:l.netAmount,checkoutUrl:l.checkoutUrl,customerEmail:l.customerEmail,customerName:l.customerName,metadata:l.metadata,expiresAt:l.expiresAt,completedAt:l.completedAt,createdAt:l.createdAt}};