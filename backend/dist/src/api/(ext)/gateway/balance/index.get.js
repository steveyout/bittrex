"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error");exports.metadata={summary:"Get merchant balance",description:"Gets the merchant's balance across all currencies.",operationId:"getMerchantBalance",tags:["Gateway","Merchant","Balance"],responses:{200:{description:"Balance information"}},requiresAuth:!0,logModule:"GATEWAY",logTitle:"Get Gateway Balance"};exports.default=async e=>{const{user:t,ctx:a}=e;if(!(null==t?void 0:t.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});const r=await db_1.models.gatewayMerchant.findOne({where:{userId:t.id}});if(!r)throw(0,error_1.createError)({statusCode:404,message:"Merchant account not found"});const l=await db_1.models.gatewayMerchantBalance.findAll({where:{merchantId:r.id},order:[["currency","ASC"]]});let o=0,s=0,n=0;const d=l.map(e=>{o+=parseFloat(e.available);s+=parseFloat(e.pending);n+=parseFloat(e.reserved);return{currency:e.currency,walletType:e.walletType,available:e.available,pending:e.pending,reserved:e.reserved,totalReceived:e.totalReceived,totalRefunded:e.totalRefunded,totalFees:e.totalFees,totalPaidOut:e.totalPaidOut}});null==a||a.success("Request completed successfully");return{balances:d,summary:{totalAvailable:o,totalPending:s,totalReserved:n},payoutSettings:{schedule:r.payoutSchedule,threshold:r.payoutThreshold,defaultCurrency:r.defaultCurrency}}};