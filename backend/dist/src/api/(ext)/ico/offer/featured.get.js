"use strict";async function getPopularIcoOfferings(e){try{const{ctx:r}=e||{};null==r||r.step("Fetching get featured ico offers");const t=await db_1.models.icoTokenOffering.findAll({attributes:["id","name","targetAmount","purchaseWalletCurrency","icon"],include:[{model:db_1.models.icoTokenDetail,as:"tokenDetail",attributes:["description"]}],limit:12,raw:!1});if(!t||0===t.length){null==r||r.success("Get Featured ICO Offers retrieved successfully");return{projects:[]}}const s=t.map(e=>e.id),i=await db_1.models.icoTransaction.findAll({attributes:["offeringId",[(0,sequelize_1.fn)("SUM",(0,sequelize_1.literal)("price * amount")),"raised"]],where:{offeringId:{[sequelize_1.Op.in]:s},status:{[sequelize_1.Op.ne]:"REJECTED"}},group:["offeringId"],raw:!0}),o={};for(const e of i)o[e.offeringId]=Number(e.raised)||0;const a=t.map(e=>{var r;const t=o[e.id]||0,s=Number(e.targetAmount)||1,i=e.purchaseWalletCurrency||"$";return{id:e.id,name:e.name,image:e.icon||"/img/placeholder.svg",description:(null===(r=e.tokenDetail)||void 0===r?void 0:r.description)||"",raised:`${t.toLocaleString()} ${i}`,target:`${s.toLocaleString()} ${i}`,progress:Math.min(Math.round(t/s*100),100)}}).sort((e,r)=>parseFloat(r.raised.replace(/[^\d.]/g,""))-parseFloat(e.raised.replace(/[^\d.]/g,""))).slice(0,6);null==r||r.success("Get Featured ICO Offers retrieved successfully");return{projects:a}}catch(e){console.error("Error in getPopularIcoOfferings:",e);throw(0,error_1.createError)({statusCode:500,message:"Internal Server Error"})}}Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;exports.default=getPopularIcoOfferings;const db_1=require("@b/db"),error_1=require("@b/utils/error"),sequelize_1=require("sequelize");exports.metadata={summary:"Get Popular ICO Offerings",description:"Returns the most popular ICO token offerings (by total raised).",operationId:"getPopularIcoOfferings",tags:["ICO","Offerings"],logModule:"ICO",logTitle:"Get Featured ICO Offers",responses:{200:{description:"Popular ICO offerings retrieved successfully.",content:{"application/json":{schema:{type:"object",properties:{projects:{type:"array",items:{type:"object",properties:{id:{type:"string"},name:{type:"string"},image:{type:"string"},description:{type:"string"},raised:{type:"string"},target:{type:"string"},progress:{type:"number"}}}}}}}}},500:{description:"Internal Server Error."}}};