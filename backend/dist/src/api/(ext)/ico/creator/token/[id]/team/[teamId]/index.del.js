"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),notifications_1=require("@b/utils/notifications");exports.metadata={summary:"Delete a Team Member",description:"Deletes a team member from the specified ICO offering for the authenticated creator.",operationId:"deleteTeamMember",tags:["ICO","Creator","Team"],requiresAuth:!0,logModule:"ICO",logTitle:"Delete ICO Team Member",parameters:[{index:0,name:"id",in:"path",description:"ICO offering ID",required:!0,schema:{type:"string"}},{index:1,name:"teamId",in:"path",description:"Team member ID",required:!0,schema:{type:"string"}}],responses:{200:{description:"Team member deleted successfully"},401:{description:"Unauthorized"},404:{description:"Team member not found"},500:{description:"Internal Server Error"}}};exports.default=async e=>{var r,t,a,i,o,s;const{user:n,params:m,ctx:l}=e,{id:d,teamId:c}=m;null===(r=null==l?void 0:l.step)||void 0===r||r.call(l,"Validating user authentication");if(!(null==n?void 0:n.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});null===(t=null==l?void 0:l.step)||void 0===t||t.call(l,"Validating request parameters");if(!d||!c)throw(0,error_1.createError)({statusCode:400,message:"Offering ID and Team Member ID are required"});null===(a=null==l?void 0:l.step)||void 0===a||a.call(l,"Fetching team member from database");const u=await db_1.models.icoTeamMember.findOne({where:{id:c,offeringId:d}});if(!u)throw(0,error_1.createError)({statusCode:404,message:"Team member not found"});const f=u.name;null===(i=null==l?void 0:l.step)||void 0===i||i.call(l,"Deleting team member");await u.destroy();null===(o=null==l?void 0:l.step)||void 0===o||o.call(l,"Creating deletion notification");try{await(0,notifications_1.createNotification)({userId:n.id,relatedId:d,type:"system",title:"Team Member Removed",message:`Team member "${f}" has been removed successfully.`,details:"The selected team member was removed from your ICO offering.",link:`/ico/creator/token/${d}?tab=team`,actions:[{label:"View Team",link:`/ico/creator/token/${d}?tab=team`,primary:!0}]})}catch(e){console.error("Failed to create notification for team member deletion",e)}null===(s=null==l?void 0:l.success)||void 0===s||s.call(l,"Team member deleted successfully");return{message:"Team member deleted successfully"}};