"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),notifications_1=require("@b/utils/notifications");exports.metadata={summary:"Upgrade ICO Offering Plan",description:"Updates the launch plan for the specified ICO offering for the authenticated creator.",operationId:"upgradeOfferingPlan",tags:["ICO","Creator","Plan"],requiresAuth:!0,logModule:"ICO_PLAN",logTitle:"Upgrade offering plan",parameters:[{index:0,name:"id",in:"path",description:"ICO offering ID",required:!0,schema:{type:"string"}}],requestBody:{description:"New plan ID",required:!0,content:{"application/json":{schema:{type:"object",properties:{planId:{type:"string"}},required:["planId"]}}}},responses:{200:{description:"Plan upgraded successfully"},400:{description:"Bad Request"},401:{description:"Unauthorized"},404:{description:"Offering not found"},500:{description:"Internal Server Error"}}};exports.default=async e=>{const{user:r,params:t,body:a,ctx:i}=e,n=t.id,{planId:o}=a;if(!(null==r?void 0:r.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});if(!n||!o)throw(0,error_1.createError)({statusCode:400,message:"Offering ID and planId are required"});null==i||i.step("Validating plan upgrade request");const s=await db_1.models.icoTokenOffering.findOne({where:{id:n,userId:r.id}});if(!s)throw(0,error_1.createError)({statusCode:404,message:"Offering not found"});null==i||i.step("Updating offering plan");await s.update({planId:o});null==i||i.step("Sending notification");try{await(0,notifications_1.createNotification)({userId:r.id,relatedId:s.id,type:"system",title:"ICO Offering Plan Upgraded",message:`Your ICO offering "${s.name}" has been upgraded successfully.`,details:"Your offering plan has been updated to the new plan. Please check your dashboard to review the updated features and benefits.",link:`/ico/creator/token/${s.id}`,actions:[{label:"View Offering",link:`/ico/creator/token/${s.id}`,primary:!0}]})}catch(e){console.error("Failed to create notification for plan upgrade",e)}null==i||i.success(`Upgraded plan for offering "${s.name}"`);return{message:"Plan upgraded successfully"}};