"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),notifications_1=require("@b/utils/notifications");exports.metadata={summary:"Delete a Roadmap Item",description:"Deletes a roadmap item from the specified ICO offering for the authenticated creator.",operationId:"deleteRoadmapItem",tags:["ICO","Creator","Roadmap"],requiresAuth:!0,logModule:"ICO",logTitle:"Delete ICO Roadmap Item",parameters:[{index:0,name:"id",in:"path",description:"ICO offering ID",required:!0,schema:{type:"string"}},{index:1,name:"roadmapId",in:"path",description:"Roadmap item ID",required:!0,schema:{type:"string"}}],responses:{200:{description:"Roadmap item deleted successfully"},401:{description:"Unauthorized"},404:{description:"Roadmap item not found"},500:{description:"Internal Server Error"}}};exports.default=async e=>{var t,a,r,i,o,d;const{user:s,params:l,ctx:n}=e,{id:m,roadmapId:c}=l;null===(t=null==n?void 0:n.step)||void 0===t||t.call(n,"Validating user authentication");if(!(null==s?void 0:s.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});null===(a=null==n?void 0:n.step)||void 0===a||a.call(n,"Validating request parameters");if(!m||!c)throw(0,error_1.createError)({statusCode:400,message:"Offering ID and Roadmap Item ID are required"});null===(r=null==n?void 0:n.step)||void 0===r||r.call(n,"Fetching roadmap item from database");const u=await db_1.models.icoRoadmapItem.findOne({where:{id:c,offeringId:m}});if(!u)throw(0,error_1.createError)({statusCode:404,message:"Roadmap item not found"});const p=u.title;null===(i=null==n?void 0:n.step)||void 0===i||i.call(n,"Deleting roadmap item");await u.destroy();null===(o=null==n?void 0:n.step)||void 0===o||o.call(n,"Creating deletion notification");try{await(0,notifications_1.createNotification)({userId:s.id,relatedId:m,type:"system",title:"Roadmap Item Deleted",message:`Roadmap item "${p}" deleted successfully.`,details:"The selected roadmap item has been removed from your offering.",link:`/ico/creator/token/${m}?tab=roadmap`,actions:[{label:"View Offering",link:`/ico/creator/token/${m}?tab=roadmap`,primary:!0}]})}catch(e){console.error("Failed to create deletion notification",e)}null===(d=null==n?void 0:n.success)||void 0===d||d.call(n,"Roadmap item deleted successfully");return{message:"Roadmap item deleted successfully"}};