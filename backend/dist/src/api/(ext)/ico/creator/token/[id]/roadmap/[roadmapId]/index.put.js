"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),notifications_1=require("@b/utils/notifications");exports.metadata={summary:"Update a Roadmap Item",description:"Updates a roadmap item of a specified ICO offering for the authenticated creator.",operationId:"updateRoadmapItem",tags:["ICO","Creator","Roadmap"],requiresAuth:!0,logModule:"ICO_ROADMAP",logTitle:"Update roadmap item",parameters:[{index:0,name:"id",in:"path",description:"ICO offering ID",required:!0,schema:{type:"string"}},{index:1,name:"roadmapId",in:"path",description:"Roadmap item ID",required:!0,schema:{type:"string"}}],requestBody:{description:"Updated roadmap item data",required:!0,content:{"application/json":{schema:{type:"object",properties:{title:{type:"string"},description:{type:"string"},date:{type:"string"},completed:{type:"boolean"}},required:["title","description","date"]}}}},responses:{200:{description:"Roadmap item updated successfully"},400:{description:"Bad Request"},401:{description:"Unauthorized"},404:{description:"Roadmap item not found"},500:{description:"Internal Server Error"}}};exports.default=async e=>{const{user:t,params:a,body:r,ctx:i}=e,{id:o,roadmapId:d}=a;if(!(null==t?void 0:t.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});if(!o||!d)throw(0,error_1.createError)({statusCode:400,message:"Offering ID and Roadmap Item ID are required"});null==i||i.step("Validating roadmap update request");const s=await db_1.models.icoRoadmapItem.findOne({where:{id:d,offeringId:o}});if(!s)throw(0,error_1.createError)({statusCode:404,message:"Roadmap item not found"});const n=s.title;null==i||i.step("Updating roadmap item");await s.update(r);null==i||i.step("Sending notification");try{await(0,notifications_1.createNotification)({userId:t.id,relatedId:o,type:"system",title:"Roadmap Item Updated",message:`Roadmap item "${r.title}" updated successfully.`,details:"The roadmap item has been updated."+(n!==r.title?` Title changed from "${n}" to "${r.title}".`:""),link:`/ico/creator/token/${o}?tab=roadmap`,actions:[{label:"View Offering",link:`/ico/creator/token/${o}?tab=roadmap`,primary:!0}]})}catch(e){console.error("Failed to create update notification",e)}null==i||i.success(`Updated roadmap item "${r.title}"`);return{message:"Roadmap item updated successfully"}};