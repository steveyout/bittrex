"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),notifications_1=require("@b/utils/notifications");exports.metadata={summary:"Update a Team Member",description:"Updates a team member of a specified ICO offering for the authenticated creator.",operationId:"updateTeamMember",tags:["ICO","Creator","Team"],requiresAuth:!0,logModule:"ICO_TEAM",logTitle:"Update team member",parameters:[{index:0,name:"id",in:"path",description:"ICO offering ID",required:!0,schema:{type:"string"}},{index:1,name:"teamId",in:"path",description:"Team member ID",required:!0,schema:{type:"string"}}],requestBody:{description:"Updated team member data",required:!0,content:{"application/json":{schema:{type:"object",properties:{name:{type:"string"},role:{type:"string"},bio:{type:"string"},avatar:{type:"string"},linkedin:{type:"string"},twitter:{type:"string"},website:{type:"string"},github:{type:"string"}},required:["name","role","bio"]}}}},responses:{200:{description:"Team member updated successfully"},400:{description:"Bad Request"},401:{description:"Unauthorized"},404:{description:"Team member not found"},500:{description:"Internal Server Error"}}};exports.default=async e=>{const{user:t,params:r,body:a,ctx:i}=e,{id:o,teamId:s}=r;if(!(null==t?void 0:t.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});if(!o||!s)throw(0,error_1.createError)({statusCode:400,message:"Offering ID and Team Member ID are required"});null==i||i.step("Validating team member update request");const n=await db_1.models.icoTeamMember.findOne({where:{id:s,offeringId:o}});if(!n)throw(0,error_1.createError)({statusCode:404,message:"Team member not found"});const m=n.name;null==i||i.step("Updating team member record");await n.update(a);null==i||i.step("Sending notification");try{await(0,notifications_1.createNotification)({userId:t.id,relatedId:o,type:"system",title:"Team Member Updated",message:`Team member "${a.name}" updated successfully.`,details:"The team member details have been updated."+(m!==a.name?` Name changed from "${m}" to "${a.name}".`:""),link:`/ico/creator/token/${o}?tab=team`,actions:[{label:"View Team",link:`/ico/creator/token/${o}?tab=team`,primary:!0}]})}catch(e){console.error("Failed to create update notification for team member",e)}null==i||i.success(`Updated team member "${a.name}"`);return{message:"Team member updated successfully"}};