"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.metadata=void 0;const db_1=require("@b/db"),error_1=require("@b/utils/error"),notifications_1=require("@b/utils/notifications");exports.metadata={summary:"Add a Team Member to an ICO Offering",description:"Adds a new team member to the specified ICO offering for the authenticated creator.",operationId:"addTeamMember",tags:["ICO","Creator","Team"],requiresAuth:!0,logModule:"ICO_TEAM",logTitle:"Add team member",parameters:[{index:0,name:"id",in:"path",description:"ICO offering ID",required:!0,schema:{type:"string"}}],requestBody:{description:"Team member data",required:!0,content:{"application/json":{schema:{type:"object",properties:{name:{type:"string"},role:{type:"string"},bio:{type:"string"},avatar:{type:"string"},linkedin:{type:"string"},twitter:{type:"string"},website:{type:"string"},github:{type:"string"}},required:["name","role","bio"]}}}},responses:{200:{description:"Team member added successfully",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}},400:{description:"Bad Request"},401:{description:"Unauthorized"},500:{description:"Internal Server Error"}}};exports.default=async e=>{const{user:r,params:t,body:a,ctx:i}=e,o=t.id;if(!(null==r?void 0:r.id))throw(0,error_1.createError)({statusCode:401,message:"Unauthorized"});if(!o)throw(0,error_1.createError)({statusCode:400,message:"Offering ID is required"});null==i||i.step("Validating team member request");const s=await db_1.models.icoTokenOffering.findOne({where:{id:o,userId:r.id},include:[{model:db_1.models.icoLaunchPlan,as:"plan"},{model:db_1.models.icoTeamMember,as:"teamMembers"}]});if(!s)throw(0,error_1.createError)({statusCode:404,message:"Offering not found"});null==i||i.step("Checking team member limit");if(s.plan&&s.teamMembers.length>=s.plan.features.maxTeamMembers)throw(0,error_1.createError)({statusCode:400,message:"Team member limit reached. Upgrade your plan to add more team members."});null==i||i.step("Creating team member record");await db_1.models.icoTeamMember.create({...a,offeringId:o});null==i||i.step("Sending notification");try{await(0,notifications_1.createNotification)({userId:r.id,relatedId:o,type:"system",title:"New Team Member Added",message:`New team member "${a.name}" added successfully.`,details:"A new team member has been added to your ICO offering.",link:`/ico/creator/token/${o}?tab=team`,actions:[{label:"View Team",link:`/ico/creator/token/${o}?tab=team`,primary:!0}]})}catch(e){console.error("Failed to create notification for team member addition",e)}null==i||i.success(`Added team member "${a.name}"`);return{message:"Team member added successfully"}};